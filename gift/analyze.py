# analyze.py

import argparse
import json
import re
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
import random
from collections import Counter

from pygments import highlight
import yaml

"""
åŠ¨æ€ä¸ªæ€§åŒ–é¢å‘å¯¹è±¡è¯¾ç¨‹æ•°æ®åˆ†æè„šæœ¬ V8.6 (è¯­æ–™å¢å¼ºç‰ˆ)

åŠŸèƒ½:
1.  [V8.6 ä¼˜åŒ–] ä¼˜åŒ–è¯­æ–™åº“ï¼Œå¯¹éƒ¨åˆ†è¯­å¥è¿›è¡Œæ‰©å†™ä¸æ¶¦è‰²ï¼Œå¼•å…¥æ›´å¤šå˜é‡ï¼ŒæŠ¥å‘Šæ›´å…·ä¸ªæ€§åŒ–ä¸ç”ŸåŠ¨æ€§ã€‚
2.  [V8.5 æ–°å¢] æ–°å¢äº’æµ‹åšå¼ˆè¿‡ç¨‹åˆ†æï¼Œæ´å¯ŸHackæ—¶æœºï¼ˆé—ªç”µæˆ˜/å·å¡”ï¼‰ã€ç›®æ ‡é€‰æ‹©ï¼ˆé›†ç«/å¹¿æ’’ç½‘ï¼‰ç­‰é«˜çº§ç­–ç•¥ã€‚
3.  [V8.5 æ–°å¢] å¼•å…¥åŸºäºåŒæˆ¿é—´æ•°æ®çš„ç›¸å¯¹è¡¨ç°åˆ†æï¼Œæ–°å¢â€œé£æš´å¹¸å­˜è€…â€ã€â€œç²¾å‡†æ‰“å‡»è€…â€ã€â€œæˆ˜æœ¯å¤§å¸ˆâ€ç­‰æƒ…æ™¯åŒ–æ ‡ç­¾ã€‚
4.  è§£æåŒ…å«è¯¾ç¨‹ä½œä¸šAPIæ•°æ®çš„JSONæ–‡ä»¶ã€‚
5.  [V8.0 åŠŸèƒ½] æ–°å¢â€œç‹è€…å½’æ¥â€ã€â€œæ¼æ´ä¿®å¤ä¸“å®¶â€ç­‰äº®ç‚¹æ ‡ç­¾ï¼Œæ·±åº¦æŒ–æ˜æˆé•¿ä¸è´£ä»»æ„Ÿã€‚
6.  [V8.0 åŠŸèƒ½] æ–°å¢æ€§èƒ½ç“¶é¢ˆï¼ˆRTLE/CTLEï¼‰ä¸“é¡¹åˆ†æï¼Œå°¤å…¶å…³æ³¨ç¬¬äºŒå•å…ƒå¹¶å‘æŒ‘æˆ˜ã€‚
7.  [V8.0 åŠŸèƒ½] å…¨é¢å¯ç”¨å¹¶ä¼˜åŒ–è¯­æ–™åº“ï¼Œç”Ÿæˆå…³äºç¨³å®šæ€§ã€æ”»é˜²é£æ ¼çš„æ·±åº¦æ–‡å­—åˆ†æï¼ŒæŠ¥å‘Šæ›´å…·æ´å¯ŸåŠ›ã€‚
8.  [V7.0 åŠŸèƒ½] å¼•å…¥å­¦ç”Ÿç”»åƒç³»ç»Ÿ (é˜²å¾¡è€…/æ”»å‡»è€…/æ”¹è¿›è€…/DDLæˆ˜ç¥)ï¼Œç”Ÿæˆé«˜åº¦ä¸ªæ€§åŒ–æŠ¥å‘Šã€‚
9.  [V7.0 åŠŸèƒ½] æ·±åº¦æŒ–æ˜Bugä¿®å¤æ•°æ®ï¼Œåˆ†æBugä¿®å¤ç‡ã€æ”»é˜²å¾—åˆ†æ¯”ï¼Œè¯„ä¼°å¼€å‘è€…è´£ä»»æ„Ÿã€‚
10. [V7.0 åŠŸèƒ½] è¯¦ç»†è§£æç¬¬å››å•å…ƒUMLæ¨¡å‹æ£€æŸ¥ç‚¹ï¼Œæä¾›é’ˆå¯¹æ€§åé¦ˆã€‚
11. [V7.0 åŠŸèƒ½] æ•´åˆæ ¸å¿ƒå›¾è¡¨ä¸º2x2çš„â€œç»¼åˆè¡¨ç°ä»ªè¡¨ç›˜â€ï¼Œä¿¡æ¯æ›´é›†ä¸­ã€‚
12. æ·±åº¦åˆ†ææ”»é˜²ç­–ç•¥æ¼”åŒ–ã€æäº¤è¡Œä¸ºä¸ä»£ç è´¨é‡çš„å…³è”ã€‚
13. å¼•å…¥åŸºäºæˆ¿é—´ç­‰çº§çš„åŠ æƒé˜²å¾¡åˆ†ï¼Œæ›´ç§‘å­¦åœ°è¯„ä¼°é²æ£’æ€§ã€‚
14. ä½¿ç”¨å¤§å‹è¯­æ–™åº“ï¼Œç”Ÿæˆæ¯æ¬¡éƒ½ä¸åŒçš„ã€å……æ»¡æ´å¯Ÿä¸ä¸ªæ€§çš„åˆ†ææŠ¥å‘Šã€‚
15. ç”Ÿæˆå¤šç»´åº¦ã€ä¿¡æ¯ä¸°å¯Œçš„å¯è§†åŒ–å›¾è¡¨ã€‚

å¦‚ä½•ä½¿ç”¨:
1.  å°†ä½ çš„JSONæ•°æ®æ–‡ä»¶ï¼ˆå¦‚ result1.txt æˆ–æœ¬ä¾‹ä¸­çš„ tmp.jsonï¼‰ä¸æ­¤è„šæœ¬æ”¾åœ¨åŒä¸€ç›®å½•ã€‚
2.  åˆ›å»ºä¸€ä¸ªåä¸º `config.yml` çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­å†™å…¥ä½ çš„å­¦å·ï¼Œæ ¼å¼å¦‚ä¸‹:
    stu_id: 23371265
3.  ç¡®ä¿å·²å®‰è£…æ‰€éœ€åº“: pip install pandas matplotlib numpy pyyaml
4.  è¿è¡Œè„šæœ¬: python3 analyze.py
"""

# --- 1. é…ç½®åŒº ---
CONFIG = {
    "FILE_PATH": "tmp.json",
    "YAML_CONFIG_PATH": "config.yml",
    "USER_INFO": {
        "real_name": None,
        "name": None,
        "student_id": None,
        "email": None
    },
    "HOMEWORK_NUM_MAP": {
        'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5, 'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8,
        'ä¹': 9, 'å': 10, 'åä¸€': 11, 'åäºŒ': 12, 'åä¸‰': 13, 'åå››': 14, 'åäº”': 15
    },
    "UNIT_MAP": {
        "ç¬¬ä¸€å•å…ƒï¼šè¡¨è¾¾å¼æ±‚å¯¼": list(range(1, 5)),
        "ç¬¬äºŒå•å…ƒï¼šå¤šçº¿ç¨‹ç”µæ¢¯": list(range(5, 9)),
        "ç¬¬ä¸‰å•å…ƒï¼šJMLè§„æ ¼åŒ–è®¾è®¡": list(range(9, 13)),
        "ç¬¬å››å•å…ƒï¼šUMLè§£æ": list(range(13, 16)),
    },
    "FONT_FAMILY": ['WenQuanYi Zen Hei', 'SimHei', 'Microsoft YaHei', 'sans-serif']
}
# --- Matplotlib è®¾ç½® ---
plt.rcParams['font.sans-serif'] = CONFIG["FONT_FAMILY"]
plt.rcParams['axes.unicode_minus'] = False


# --- 2. è¯­æ–™åº“ (Corpus) V8.6 ä¼˜åŒ–ç‰ˆ ---
class ReportCorpus:
    PERSONA_ANALYSIS = {
        "FORTRESS": "ä½ å¥½ï¼Œ{user_name}ï¼æ¬¢è¿æŸ¥é˜…ä½ çš„OOå­¦ä¹ çºªå®ã€‚æ•°æ®æ˜¾ç¤ºï¼Œä½ å¦‚åŒä¸€ä½â€˜ç¨³å¥é˜²å¾¡è€…â€™ï¼Œä»£ç è´¨é‡åšå¦‚ç£çŸ³ï¼Œåœ¨é£æµªä¸­å§‹ç»ˆä¿æŒç€å“è¶Šçš„ç¨³å®šæ€§ã€‚è®©æˆ‘ä»¬ä¸€åŒå›é¡¾è¿™æ®µæ„ç­‘ä»£ç å ¡å’çš„æ—…ç¨‹ã€‚",
        "HUNTER": "ä½ å¥½ï¼Œ{user_name}ï¼è¿™ä»½æŠ¥å‘Šå°†å¸¦ä½ é‡æ¸©OOè¯¾ç¨‹ä¸­çš„é«˜å…‰æ—¶åˆ»ã€‚ä½ çš„æ•°æ®ç”»åƒæ˜¾ç¤ºå‡ºä¸€ä½â€˜æ•é”æ”»å‡»è€…â€™çš„ç‰¹è´¨ï¼Œæ€»èƒ½æ´å¯Ÿä»–äººä»£ç çš„å¾®å¦™ä¹‹å¤„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä½â€˜çŒäººâ€™çš„è¾‰ç…Œæˆ˜ç»©ã€‚",
        "GRINDER": "æ¬¢è¿æŸ¥é˜…ä½ çš„OOå­¦ä¹ çºªå®ï¼Œ{user_name}ã€‚æ•°æ®æ˜¾ç¤ºï¼Œä½ æ˜¯ä¸€ä½å…¸å‹çš„â€˜è¿­ä»£æ”¹è¿›è€…â€™ï¼Œé€šè¿‡ä¸æ‡ˆçš„åŠªåŠ›å’Œåå¤æ‰“ç£¨ï¼Œå®ç°äº†æŠ€æœ¯çš„æŒç»­è·ƒè¿ã€‚æ±—æ°´æµ‡çŒçš„èŠ±æœµï¼Œæ ¼å¤–é²œè‰³ã€‚",
        "SPRINTER": "ä½ å¥½ï¼Œ{user_name}ï¼æ¬¢è¿æ¥åˆ°ä½ çš„OOæ—¶é—´èƒ¶å›Šã€‚æ•°æ®æ˜¾ç¤ºï¼Œä½ æ˜¯ä¸€ä½å‡ºè‰²çš„â€˜DDLæˆ˜ç¥â€™ï¼Œæ“…é•¿åœ¨å‹åŠ›ä¹‹ä¸‹çˆ†å‘å‡ºæƒŠäººçš„æ•ˆç‡å’Œåˆ›é€ åŠ›ã€‚è®©æˆ‘ä»¬ä¸€åŒå›é¡¾é‚£äº›åœ¨deadlineå‰å®Œæˆçš„åä¸½å†²åˆºã€‚",
        "BALANCED": "ä½ å¥½ï¼Œ{user_name}ï¼è¿™ä»½æŠ¥å‘Šå°†å¸¦ä½ ç©¿è¶Šæ—¶ç©ºï¼Œå›é¡¾ä½ åœ¨OOè¯¾ç¨‹ä¸­çš„ä¸€æ®µéå‡¡æ—…ç¨‹ã€‚æ•°æ®æ˜¾ç¤ºä½ æ˜¯ä¸€ä½æ”»é˜²å‡è¡¡ã€ç¨³æ‰ç¨³æ‰“çš„â€˜å…¨èƒ½å‹é€‰æ‰‹â€™ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ­å¼€æ•°æ®çš„é¢çº±ï¼Œçœ‹çœ‹æ±—æ°´ä¸ä»£ç äº¤ç»‡å‡ºçš„æˆé•¿ç”»å·ã€‚"
    }
    BUG_FIX_ANALYSIS = {
        "HIGH_FIX_RATE": "åœ¨Bugä¿®å¤é˜¶æ®µï¼Œä½ çš„è¡¨ç°å ªç§°å…¸èŒƒã€‚å¯¹äºè¢«å‘ç°çš„ {total_bugs} ä¸ªbugï¼Œä½ æˆåŠŸä¿®å¤äº† {fixed_bugs} ä¸ªï¼Œä¿®å¤ç‡é«˜è¾¾ {rate:.1f}%ã€‚è¿™ä½“ç°äº†ä½ ä½œä¸ºå¼€å‘è€…çš„è´£ä»»å¿ƒä¸å¼ºå¤§çš„è°ƒè¯•çº é”™èƒ½åŠ›ã€‚",
        "LOW_FIX_RATE": "åœ¨Bugä¿®å¤é˜¶æ®µï¼Œæ•°æ®æ˜¾ç¤ºä½ åœ¨è¢«å‘ç°çš„ {total_bugs} ä¸ªbugä¸­ä¿®å¤äº† {fixed_bugs} ä¸ªï¼ˆä¿®å¤ç‡ {rate:.1f}%ï¼‰ã€‚é‚£äº›æœªä¿®å¤çš„bugæ˜¯å®è´µçš„å­¦ä¹ æœºä¼šï¼Œå®ƒä»¬æé†’æˆ‘ä»¬ï¼Œä¿®å¤bugä¸ç¼–å†™æ–°åŠŸèƒ½åŒç­‰é‡è¦ã€‚",
        "HACK_FOCUSED": "ä»ä¿®å¤å¾—åˆ†æ¥çœ‹ï¼Œä½ çš„è¿›æ”»å¾—åˆ†ï¼ˆ{hack_score:.2f}ï¼‰è¿œé«˜äºä¿®å¤å¤±åˆ†ï¼ˆ{hacked_score:.2f}ï¼‰ï¼Œå¾—åˆ†æ¯”ä¸º {ratio:.2f}ã€‚è¿™è¡¨æ˜ä½ æ›´å€¾å‘äºé€šè¿‡ä¸»åŠ¨å‡ºå‡»å¯»æ‰¾ä»–äººbugæ¥è·å–åˆ†æ•°ï¼Œæ˜¯ä¸€ä½ç­–ç•¥æ¸…æ™°çš„â€˜æ”»å‡»å‹â€™é€‰æ‰‹ã€‚",
        "FIX_FOCUSED": "ä»ä¿®å¤å¾—åˆ†æ¥çœ‹ï¼Œä½ é€šè¿‡ä¿®å¤è‡ªèº«bugæŒ½å›çš„åˆ†æ•°ï¼ˆ{hacked_score:.2f}ï¼‰å äº†ä¸»å¯¼åœ°ä½ï¼ˆå¾—åˆ†æ¯” {ratio:.2f}ï¼‰ã€‚è¿™è¡¨æ˜ä½ éå¸¸ä¸“æ³¨äºå·©å›ºè‡ªèº«ä»£ç çš„è´¨é‡ï¼Œæ˜¯ä¸€ä½æ²‰ç¨³çš„â€˜é˜²å¾¡å‹â€™é€‰æ‰‹ã€‚",
        "NO_BUGS_TO_FIX": "åœ¨æ•´ä¸ªå­¦æœŸçš„Bugä¿®å¤ç¯èŠ‚ï¼Œä½ çš„ä»£ç æœªæ›¾è¢«å‘ç°ä»»ä½•å¯ä¿®å¤çš„bugï¼Œè¿™æ˜¯ä¸€ä¸ªäº†ä¸èµ·çš„æˆå°±ï¼"
    }
    UML_ANALYSIS = {
        "PERFECT": [ # [V8.6 æ‰©å†™]
            "  - UMLæ¨¡å‹è§£æ: å®Œç¾é€šè¿‡æ‰€æœ‰æ£€æŸ¥ç‚¹ï¼Œå±•ç°äº†ä½ å¯¹ç±»å›¾ã€çŠ¶æ€å›¾å’Œé¡ºåºå›¾çš„æ·±åˆ»ç†è§£ã€‚",
            "  - UMLæ¨¡å‹è§£æ: ä½ çš„UMLè§£æå™¨è¡¨ç°å ªç§°å®Œç¾ï¼Œç²¾ç¡®æ— è¯¯åœ°è§£è¯»äº†æ‰€æœ‰æ¨¡å‹ï¼Œæ‰€æœ‰æ£€æŸ¥ç‚¹å‡é¡ºåˆ©é€šè¿‡ã€‚",
        ],
        "IMPERFECT": [ # [V8.6 æ‰©å†™]
            "  - UMLæ¨¡å‹è§£æ: åœ¨ä»¥ä¸‹æ£€æŸ¥ç‚¹é‡åˆ°æŒ‘æˆ˜ï¼š{issues}ã€‚è¿™é€šå¸¸æ˜¯æ¨¡å‹é—´å…³è”çš„éš¾ç‚¹ï¼Œä¹Ÿæ˜¯æ·±å…¥ç†è§£UMLçš„ç»ä½³æœºä¼šã€‚",
            "  - UMLæ¨¡å‹è§£æ: åœ¨è§£æä¸­ï¼Œä»¥ä¸‹éƒ¨åˆ†éœ€è¦å…³æ³¨ï¼š{issues}ã€‚è¿™äº›å¤æ‚çš„äº¤äº’ç‚¹æ­£æ˜¯UMLå­¦ä¹ çš„æ ¸å¿ƒï¼Œæ”»å…‹å®ƒä»¬æ„å‘³ç€æ›´å¤§çš„è¿›æ­¥ã€‚",
        ]
    }
    HIGHLIGHTS_INTRO = [ # [V8.6 æ‰©å†™]
        "åŸºäºä½ çš„å­¦æœŸæ•°æ®ï¼Œæˆ‘ä»¬ä¸ºä½ æç‚¼äº†ä»¥ä¸‹å‡ ä¸ªé—ªäº®çš„ä¸ªäººæ ‡ç­¾ï¼š",
        "æ•°æ®ä¸ä¼šè¯´è°ï¼Œå®ƒä»¬ä¸ºä½ æç»˜äº†ä¸€å¹…ç‹¬ç‰¹çš„å¼€å‘è€…ç”»åƒã€‚ä»¥ä¸‹æ˜¯ä¸ºä½ ä¸“å±å®šåˆ¶çš„äº®ç‚¹æ ‡ç­¾ï¼š",
        "åœ¨æµ·é‡çš„ä»£ç ä¸æäº¤è®°å½•ä¸­ï¼Œæˆ‘ä»¬æ•æ‰åˆ°äº†ä½ ç‹¬æœ‰çš„é—ªå…‰ç‚¹ã€‚è¯·çœ‹ä½ çš„é«˜å…‰æ—¶åˆ»é›†é”¦ï¼š",
    ]
    HIGHLIGHTS_TAGS = {
        # --- é«˜åˆ†/å“è¶Šå‹ ---
        "TOP_SCORER": "  - ğŸ† å­¦éœ¸æœ¬è‰²: ä½ çš„å¼ºæµ‹å¹³å‡åˆ†é«˜è¾¾{avg_score:.2f}ï¼Œä½åˆ—é¡¶å°–æ°´å¹³ï¼Œå±•ç°äº†å¼ºå¤§çš„ç¡¬å®åŠ›ã€‚",
        "ROCK_SOLID": "  - ğŸ’ ç¨³å¦‚ç£çŸ³: æ•´ä¸ªå­¦æœŸï¼Œä½ çš„å¼ºæµ‹æœ€ä½åˆ†ä»é«˜è¾¾ {min_score:.2f}ï¼Œä¸”å‡ ä¹æœªåœ¨äº’æµ‹ä¸­å¤±å®ˆã€‚ä»£ç è´¨é‡ç¨³å®šå¾—ä»¤äººæƒŠå¹ï¼",
        "DEFENSE_MASTER": "  - ğŸ›¡ï¸ é˜²å¾¡å¤§å¸ˆ: ä½ çš„ä»£ç åœ¨è¶…è¿‡75%çš„äº’æµ‹ä¸­ä¿æŒé›¶å¤±è¯¯ï¼Œå ªç§°å›ºè‹¥é‡‘æ±¤ã€‚",
        "HACK_ARTIST": "  - âš”ï¸ æœºä¼šä¸»ä¹‰é»‘å®¢: åœ¨ã€Œ{hw_name}ã€ä¸­ï¼Œä½ æ•é”åœ°æŠ“ä½æœºä¼šï¼Œå‘èµ·äº†{count}æ¬¡æˆåŠŸHackï¼Œä¸€æˆ˜æˆåã€‚",
        "JML_MASTER": "  - ğŸ“œ JMLå¤§å¸ˆ: åœ¨ç¬¬ä¸‰å•å…ƒï¼Œä½ å®Œç¾åœ°é©¾é©­äº†JMLè§„æ ¼ï¼Œæ‰€æœ‰ç›¸å…³ä½œä¸šå‡å–å¾—è¿‘ä¹æ»¡åˆ†çš„æˆç»©ï¼Œå±•ç°äº†å¯¹å½¢å¼åŒ–è®¾è®¡çš„æ·±åˆ»ç†è§£ã€‚",
        "UML_EXPERT": "  - ğŸ—ºï¸ UMLä¸“å®¶: åœ¨ç¬¬å››å•å…ƒï¼Œä½ ç²¾ç¡®åœ°è§£æäº†æ‰€æœ‰UMLæ¨¡å‹ï¼Œæ‰€æœ‰æ£€æŸ¥ç‚¹å‡å®Œç¾é€šè¿‡ï¼Œå±•ç°äº†å¯¹å¤æ‚æ¨¡å‹æ— ä¸ä¼¦æ¯”çš„æ´å¯ŸåŠ›ã€‚",
        
        # --- æ•ˆç‡/æ–¹æ³•å‹ ---
        "EFFICIENCY_ACE": "  - âš¡ æ•ˆç‡å¥‡æ‰: åœ¨ã€Œ{hw_name}ã€ç­‰å¤šæ¬¡ä»»åŠ¡ä¸­ï¼Œä½ ä»¥æå°‘çš„æäº¤æ¬¡æ•°ä¸€æ¬¡é€šè¿‡ï¼Œå±•ç°äº†å“è¶Šçš„å¼€å‘æ•ˆç‡ã€‚",
        "FAST_STARTER": "  - ğŸš€ å¼€å±€å†²åˆºæ‰‹: åœ¨ã€Œ{hw_name}ã€ç­‰å¤šæ¬¡ä½œä¸šä¸­ï¼Œä½ éƒ½åœ¨æ—©æœŸå°±å®Œæˆäº†é¦–æ¬¡æäº¤ï¼Œå±•ç°äº†æå¼ºçš„å­¦ä¹ ä¸»åŠ¨æ€§å’Œè§„åˆ’èƒ½åŠ›ã€‚",
        "DEADLINE_COMEBACK": "  - â° DDLé€†è¢­è€…: åœ¨ã€Œ{hw_name}ã€ç­‰ä»»åŠ¡ä¸­ï¼Œä½ æ•°æ¬¡åœ¨æœ€ç»ˆæ—¶åˆ»åŠ›æŒ½ç‹‚æ¾œï¼Œæäº¤çš„ä»£ç ä¾ç„¶å–å¾—äº†ä¼˜è‰¯æˆç»©ï¼Œå±•ç°äº†éå‡¡çš„æŠ—å‹èƒ½åŠ›ã€‚",

        # --- æˆé•¿/æ€åº¦å‹ (æ™®é€‚æ€§æ›´å¼º) ---
        "COMEBACK_KING": "  - ğŸ“ˆ ç‹è€…å½’æ¥: ä»å­¦æœŸåˆçš„{u1_score:.1f}åˆ†åˆ°å­¦æœŸæœ«çš„{u4_score:.1f}åˆ†ï¼Œä½ çš„å¹³å‡åˆ†å®ç°äº†æ˜¾è‘—æå‡ï¼Œå±•ç°äº†æƒŠäººçš„å­¦ä¹ èƒ½åŠ›å’ŒååŠ²ã€‚", # [V8.6 ä¼˜åŒ–] å¢åŠ å…·ä½“åˆ†æ•°
        "REFACTOR_VIRTUOSO": "  - ğŸ—ï¸ æ¶æ„è¿­ä»£å¤§å¸ˆ: åœ¨ã€Œ{unit_name}ã€ä¸­ï¼Œä½ é€šè¿‡æœæ–­çš„è¿­ä»£ï¼Œå®ç°äº†ä»ã€Œ{hw_name_before}ã€åˆ°ã€Œ{hw_name_after}ã€çš„é£è·ƒï¼Œå±•ç°äº†å“è¶Šçš„æ¶æ„æ¼”è¿›èƒ½åŠ›ã€‚",
        "BUG_FIXER_PRO": "  - ğŸ”§ æ¼æ´ä¿®å¤ä¸“å®¶: å¯¹äºå­¦æœŸä¸­è¢«å‘ç°çš„æ‰€æœ‰Bugï¼Œä½ éƒ½æˆåŠŸä¿®å¤ï¼Œä½“ç°äº†æè‡´çš„å¼€å‘è€…è´£ä»»æ„Ÿã€‚",
        "PERFORMANCE_CHALLENGER": "  - ğŸ’¨ å¹¶å‘æŒ‘æˆ˜è€…: ä½ åœ¨ç¬¬äºŒå•å…ƒè™½ç„¶é‡åˆ°äº†æ€§èƒ½æŒ‘æˆ˜ï¼Œä½†æœ€ç»ˆæˆåŠŸå…‹æœï¼Œå±•ç°äº†å¼ºå¤§çš„è°ƒè¯•å’Œä¼˜åŒ–èƒ½åŠ›ã€‚",
        "THE_PERSEVERER": "  - ğŸŒ± åšéŸ§ä¸æ‹”: å³ä½¿åœ¨ã€Œ{low_score_hw}ã€é‡åˆ°æŒ«æŠ˜ï¼Œä½ ä¾ç„¶åšæŒä¸æ‡ˆï¼Œå¹¶åœ¨ã€Œ{rebound_hw}ã€ä¸­å–å¾—äº†æ˜¾è‘—è¿›æ­¥ï¼Œè¿™ä»½æ¯…åŠ›æ¯”åˆ†æ•°æ›´å®è´µï¼",
        "DILIGENT_EXPLORER": "  - ğŸ§— å‹¤å¥‹çš„æ¢ç´¢è€…: æœ¬å­¦æœŸä½ ç´¯è®¡æäº¤äº† {total_submissions} æ¬¡ä»£ç ã€‚æ¯ä¸€æ¬¡æäº¤éƒ½æ˜¯ä¸€æ¬¡å®è´µçš„æ¢ç´¢ï¼Œè®°å½•äº†ä½ æ”€ç™»æŠ€æœ¯é«˜å³°çš„è¶³è¿¹ã€‚",
        "ACTIVE_COLLABORATOR": "  - ğŸ¤ ç§¯æçš„åä½œè€…: åœ¨ã€Œ{hw_name}ã€çš„äº’æµ‹ä¸­ï¼Œä½ å‘èµ·äº† {hack_attempts} æ¬¡æµ‹è¯•ï¼Œç§¯æå‚ä¸åˆ°ç¤¾åŒºåä½œä¸­ã€‚å‘ç°ä»–äººbugä¸ä¿®å¤è‡ªèº«bugåŒæ ·æ˜¯å­¦ä¹ çš„é‡è¦ä¸€ç¯ã€‚",
        
        # --- V8.5 æ–°å¢ï¼šåšå¼ˆ/æƒ…æ™¯åŒ–æ ‡ç­¾ ---
        "PRECISION_STRIKER": "  - ğŸ¯ ç²¾å‡†æ‰“å‡»è€…: åœ¨ã€Œ{hw_name}ã€ä¸­ï¼Œä½ çš„HackæˆåŠŸç‡é«˜è¾¾{rate:.0f}%ï¼Œå±•ç°äº†ä½ æ„é€ é«˜æ•ˆæµ‹è¯•ç”¨ä¾‹çš„éå‡¡èƒ½åŠ›ã€‚",
        "TACTICAL_MASTER": "  - â™Ÿï¸ æˆ˜æœ¯å¤§å¸ˆ: ä½ åœ¨ã€Œ{hw_name}ã€çš„äº’æµ‹ä¸­å±•ç°äº†æ¸…æ™°çš„æˆ˜æœ¯æ€è·¯ï¼Œé›†ä¸­ç«åŠ›æˆåŠŸæ”»ç ´äº†{target_count}ååŒå­¦çš„é˜²çº¿ã€‚",
        "STORM_SURVIVOR": "  - ğŸŒŠ é£æš´å¹¸å­˜è€…: åœ¨ã€Œ{hw_name}ã€è¿™åœºè¢«Hackæ€»æ•°é«˜è¾¾{room_total_hacked}æ¬¡çš„â€œè…¥é£è¡€é›¨â€ä¸­ï¼Œä½ ä»…è¢«æ”»ç ´{self_hacked}æ¬¡ï¼Œå±•ç°äº†è¶…å‡¡çš„ç”Ÿå­˜èƒ½åŠ›ã€‚"
    }
    HIGHLIGHTS_CATEGORIES = {
        # ... (no changes needed here)
        "TOP_SCORER": "å“è¶Šè¡¨ç°", "ROCK_SOLID": "å“è¶Šè¡¨ç°", "DEFENSE_MASTER": "å“è¶Šè¡¨ç°", "JML_MASTER": "å“è¶Šè¡¨ç°", "UML_EXPERT": "å“è¶Šè¡¨ç°", "STORM_SURVIVOR": "å“è¶Šè¡¨ç°",
        "EFFICIENCY_ACE": "é«˜æ•ˆç­–ç•¥", "FAST_STARTER": "é«˜æ•ˆç­–ç•¥", "DEADLINE_COMEBACK": "é«˜æ•ˆç­–ç•¥",
        "COMEBACK_KING": "æˆé•¿æ€åº¦", "REFACTOR_VIRTUOSO": "æˆé•¿æ€åº¦", "BUG_FIXER_PRO": "æˆé•¿æ€åº¦", "PERFORMANCE_CHALLENGER": "æˆé•¿æ€åº¦", "THE_PERSEVERER": "æˆé•¿æ€åº¦", "DILIGENT_EXPLORER": "æˆé•¿æ€åº¦", "ACTIVE_COLLABORATOR": "æˆé•¿æ€åº¦",
        "HACK_ARTIST": "åšå¼ˆé«˜æ‰‹", "PRECISION_STRIKER": "åšå¼ˆé«˜æ‰‹", "TACTICAL_MASTER": "åšå¼ˆé«˜æ‰‹",
    }
    DDL_ANALYSIS = [
        "æ•°æ®æ˜¾ç¤ºï¼Œå½“ä½ çš„ã€ŒDDLæŒ‡æ•°ã€è¾ƒé«˜æ—¶ï¼Œä»£ç å‡ºç°é—®é¢˜çš„é£é™©ä¼¼ä¹æœ‰æ‰€å¢åŠ ã€‚è¿™æç¤ºæˆ‘ä»¬ï¼Œå¯¹äºå¤æ‚ä»»åŠ¡ï¼Œé¢„ç•™æ›´å……è¶³çš„æµ‹è¯•æ—¶é—´å¯èƒ½æ•ˆæœæ›´ä½³",
        "ä½ çš„DDLæŒ‡æ•°ä¸ä»£ç è´¨é‡ä¹‹é—´æœªå‘ç°æ˜æ˜¾å…³è”ï¼Œè¿™è¡¨æ˜å³ä½¿åœ¨æ—¶é—´å‹åŠ›ä¸‹ï¼Œä½ ä¾ç„¶èƒ½ä¿æŒé«˜æ°´å¹³çš„ç¼–ç è´¨é‡ï¼Œä»¤äººé’¦ä½©",
        "DDLå‹åŠ›æµ‹è¯•æ›²çº¿æ­ç¤ºï¼šå½“æˆªæ­¢é’Ÿå£°ä¸´è¿‘æ—¶ï¼Œä½ çš„ä»£ç å¦‚åŒå‹ç¼©å¼¹ç°§ï¼Œåè€Œè¿¸å‘å‡ºæ›´å¼ºçš„ç¨³å®šæ€§",
        "åœ¨æ—¶é—´å‹åŠ›ä¸ä»£ç è´¨é‡çš„å¹³è¡¡æœ¨ä¸Šï¼Œä½ çš„è¡¨ç°å ªæ¯”ä¸“ä¸šä½“æ“é€‰æ‰‹ï¼Œæ€»èƒ½æ‰¾åˆ°å®Œç¾çš„è½åœ°å§¿æ€",
        "ç³»ç»Ÿç›‘æµ‹åˆ°ç‹¬ç‰¹çš„DDLå“åº”æ¨¡å¼ï¼šæ—¶é—´å‹åŠ›ä¸ä»…æœªå‰Šå¼±ä½ çš„ä»£ç è´¨é‡ï¼Œåè€Œæ¿€å‘æ›´ä¸¥è°¨çš„è¾¹ç•Œæ£€æŸ¥",
        "DDLæŒ‡æ•°åˆ†ææŠ¥å‘Šæ˜¾ç¤ºï¼šä½ çš„æ—¶é—´ç®¡ç†æ™ºæ…§è®©ç¼–ç èŠ‚å¥å§‹ç»ˆå¤„äºé»„é‡‘æ•ˆç‡åŒºé—´",
        "å½“DDLè­¦æŠ¥å“èµ·æ—¶ï¼Œä½ çš„ä»£ç å¦‚åŒç²¾å¯†æœºæ¢°è¡¨ï¼Œåœ¨æ—¶é—´å‹åŠ›ä¸‹ä»ä¿æŒé›¶è¯¯å·®è¿è¡Œ"
    ]
    DEFENSE_SCORE_ANALYSIS = [
        "è€ƒè™‘åˆ°ä½ é•¿æœŸåœ¨é«˜å¼ºåº¦çš„A/Bæˆ¿æˆ˜æ–—ï¼Œæˆ‘ä»¬ä¸ºä½ è®¡ç®—äº†åŠ æƒé˜²å¾¡åˆ†ã€‚ä½ çš„æœ€ç»ˆå¾—åˆ†æ˜¯ {score:.2f} (æ»¡åˆ†100)ï¼Œè¿™æ¯”åŸå§‹æ•°æ®æ›´èƒ½ä½“ç°ä½ ä»£ç çš„è¶…å‡¡é²æ£’æ€§",
        "ä½ çš„åŠ æƒé˜²å¾¡åˆ†ä¸º {score:.2f}ï¼Œè¡¨ç°å‡ºè‰²ã€‚è¿™è¯æ˜ä½ çš„ä»£ç ä¸ä»…é€»è¾‘æ­£ç¡®ï¼Œæ›´èƒ½ç»å—ä½æ¥è‡ªåŒè¡Œçš„ä¸¥è‹›è€ƒéªŒ",
        "ç»è¿‡æˆ˜åœºå‹åŠ›æ ¡å‡†ï¼Œä½ çš„çœŸå®é˜²å¾¡åŠ›æŒ‡æ•°é”å®šåœ¨ {score:.2f} åˆ†ï¼Œä½åˆ—åŒæœŸå­¦å‘˜é˜²å¾¡æ¦œTOP 5%",
        "åœ¨ {score:.2f} çš„åŠ æƒé˜²å¾¡åˆ†èƒŒåï¼Œæ˜¯å¼‚å¸¸å¤„ç†çŸ©é˜µç»å—ä½300+æ¬¡æš´åŠ›æµ‹è¯•çš„ç¡¬æ ¸è¯æ˜",
        "{score:.2f} åˆ†çš„é˜²å¾¡å ¡å’è¯„çº§æ„å‘³ç€ï¼šä½ çš„æ¯ä¸ªcatchå—éƒ½å¦‚åŒé˜²çˆ†é—¨ï¼Œèƒ½å¸æ”¶90%ä»¥ä¸Šçš„å¼‚å¸¸å†²å‡»æ³¢",
        "ç³»ç»Ÿæˆäºˆã€Œé’»çŸ³é˜²å¾¡è®¤è¯ã€ï¼šåŸºäº {score:.2f} åˆ†çš„åŠ æƒè¯„ä¼°ï¼Œä½ çš„ä»£ç åœ¨å‹åŠ›æµ‹è¯•ä¸­å®ç°é›¶å´©æºƒè®°å½•",
        "è¿™ä»½ {score:.2f} åˆ†çš„é˜²å¾¡æˆç»©å•ï¼Œå®£å‘Šä½ çš„å¼‚å¸¸å¤„ç†æœºåˆ¶å·²è¾¾åˆ°å·¥ä¸šçº§é˜²æŠ¤æ ‡å‡†"
    ]
    STRONG_TEST_HIGH_SCORE = [
        "å¼ºæµ‹æˆç»©æ˜¯ä»£ç è´¨é‡çš„ç¡¬é€šè´§ï¼Œä½ çš„è¡¨ç°å ªç§°å…¸èŒƒï¼Œå‡ ä¹æ¯æ¬¡éƒ½ç¨³ç¨³æ‹¿ä¸‹",
        "åœ¨å¼ºæµ‹çš„è€ƒéªŒä¸­ï¼Œä½ çš„ä»£ç å±•ç°å‡ºäº†æ•™ç§‘ä¹¦çº§åˆ«çš„ç¨³å®šæ€§ä¸æ­£ç¡®æ€§",
        "çºµè§‚æ•´ä¸ªå­¦æœŸï¼Œä½ çš„å¼ºæµ‹åˆ†æ•°æ›²çº¿å¦‚åŒä¸€æ¡å¹³ç¨³ä¸Šå‡çš„èˆªçº¿ï¼Œç²¾å‡†è€Œæœ‰åŠ›",
        "ä½ çš„æäº¤è®°å½•çŠ¹å¦‚ç²¾å¯†çš„ç‘å£«é’Ÿè¡¨ï¼Œåœ¨å¼ºæµ‹å‹åŠ›ä¸‹å§‹ç»ˆä¿æŒå®Œç¾èŠ‚å¾‹",
        "æ¯æ¬¡å¼ºæµ‹éƒ½æ˜¯ä½ æŠ€æœ¯å®åŠ›çš„å…¬å¼€å±•ç¤ºï¼Œè€Œä½ çš„ä»£ç æ€»èƒ½åœ¨èšå…‰ç¯ä¸‹é—ªè€€å¤ºç›®",
        "å¼ºæµ‹æˆç»©å•å¦‚åŒä½ çš„æŠ€æœ¯æŠ¤ç…§ï¼Œæ¯ä¸€é¡µéƒ½ç›–ç€ã€Œå“è¶Šæ€§èƒ½ã€çš„ç­¾è¯å°ç« ",
        "å½“å¼ºæµ‹é£æš´æ¥è¢­æ—¶ï¼Œä½ çš„ç¨‹åºå¦‚åŒå®šæµ·ç¥é’ˆï¼Œåœ¨æ€§èƒ½æ¼©æ¶¡ä¸­å²¿ç„¶ä¸åŠ¨"
    ]
    STRONG_TEST_IMPERFECTION = [
        "é‚£äº›éæ»¡åˆ†çš„ä½œä¸šï¼Œå¦‚åŒå¯»å®å›¾ä¸Šçš„æ ‡è®°ï¼ŒæŒ‡å¼•ç€ä½ æ‰¾åˆ°äº†çŸ¥è¯†çš„è–„å¼±ç‚¹ï¼Œå¹¶æœ€ç»ˆå¾æœäº†å®ƒä»¬",
        "æ¯ä¸€æ¬¡å°å°çš„å¤±åˆ†ï¼Œéƒ½åƒæ˜¯ç£¨åˆ€çŸ³ï¼Œè®©ä½ çš„ç¼–ç¨‹æŠ€è‰ºå˜å¾—æ›´åŠ é”‹åˆ©",
        "å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½ åœ¨{hw_names}ä¸Šé‡åˆ°äº†æŒ‘æˆ˜ï¼Œè¿™äº›ç»å†æ˜¯æˆé•¿çš„æœ€ä½³å‚¬åŒ–å‰‚",
        "å¼ºæµ‹ä¸­çš„å°ç¼ºå£æ°ä¼¼æŠ€æœ¯æ‹¼å›¾çš„ç•™ç™½ï¼Œæ¿€åŠ±ä½ æ¢ç´¢æ›´å®Œæ•´çš„çŸ¥è¯†ç‰ˆå›¾",
        "åœ¨{hw_names}çš„å¼ºæµ‹æˆ˜åœºä¸Šï¼Œé‚£äº›æœªå¾—çš„åˆ†æ•°åŒ–ä½œå¯¼èˆªæ˜Ÿï¼Œå¼•é¢†ä½ çªç ´è®¤çŸ¥è¾¹ç•Œ",
        "å¼ºæµ‹çš„è¯•é‡‘çŸ³ä¸ä»…æ£€éªŒä»£ç ï¼Œæ›´åœ¨{hw_names}å¤„é›•ç¢å‡ºä½ æ€ç»´çš„æ–°æ£±è§’",
        "å¼ºæµ‹æ›²çº¿ä¸Šçš„å¾®å°æ³¢åŠ¨ï¼Œåœ¨{hw_names}å¤„æ¿€èµ·æœ€ç»šçƒ‚çš„æˆé•¿æ¶Ÿæ¼ª"
    ]
    PERFORMANCE_ISSUE = [
        "ç‰¹åˆ«æ˜¯åœ¨å¤„ç† {hw_names} æ—¶é‡åˆ°çš„æ€§èƒ½é—®é¢˜ï¼ˆ{issue_types}ï¼‰ï¼Œæ˜¯ä½ ä»ã€Œèƒ½ç”¨ã€åˆ°ã€Œå¥½ç”¨ã€çš„è¿›é˜¶ä¹‹æˆ˜",
        "RTLE/CTLE æ˜¯æ¯ä¸ªä¼˜ç§€ç¨‹åºå‘˜éƒ½ä¼šé‡åˆ°çš„æ‹¦è·¯è™ï¼Œä½ æˆåŠŸé©¯æœäº†å®ƒï¼Œè¿™æ ‡å¿—ç€ä½ å¯¹ç®—æ³•å¤æ‚åº¦çš„ç†è§£è¿ˆä¸Šäº†æ–°å°é˜¶",
        "åœ¨ {hw_names} çš„æ€§èƒ½è¿·å®«ä¸­ï¼Œ{issue_types} å¦‚åŒç±³è¯ºé™¶æ´›æ–¯ï¼Œè€Œä½ ç”¨æ—¶é—´å¤æ‚åº¦åˆ†æä¹‹å‰‘æ–©å¼€äº†æœ€ä¼˜è·¯å¾„",
        "å½“ {issue_types} åœ¨ {hw_names} ä¸­æŠ•ä¸‹é˜´å½±ï¼Œä½ çš„ä¼˜åŒ–æ–¹æ¡ˆå¦‚ç ´æ™“ä¹‹å…‰ï¼Œå°†æ‰§è¡Œè€—æ—¶å‹ç¼©è‡³ç†è®ºæé™",
        "é‚£äº›åœ¨ {hw_names} ä¸­ææ–—çš„ {issue_types} å·¨å…½ï¼Œæœ€ç»ˆæˆä¸ºä½ ç®—æ³•ç²¾è¿›ä¹‹è·¯çš„å«è„šçŸ³",
        "æ€§èƒ½è°ƒä¼˜çš„è‰ºæœ¯åœ¨äºï¼šå°† {issue_types} çš„æŒ‘æˆ˜è½¬åŒ–ä¸º {hw_names} ä¸­æœ€ä¼˜é›…çš„æ—¶é—´å¤æ‚åº¦æ›²çº¿",
        "å¦‚åŒç¨‹åºå‘˜ç‰ˆçš„æ™®ç½—ç±³ä¿®æ–¯ï¼Œä½ ä» {issue_types} çš„ç«ç„°ä¸­ç›—å–äº†æ€§èƒ½ä¼˜åŒ–çš„ç¥åœ£ç«ç§ï¼Œç…§äº®äº† {hw_names} çš„é»‘æš—è§’è½"
    ]
    CONSISTENCY_STABLE = [
        "ä½ çš„å¼ºæµ‹æˆç»©æ–¹å·®ä»…ä¸º {variance:.2f}ï¼Œè¡¨ç°å‡ºæƒŠäººçš„ç¨³å®šæ€§ã€‚å¦‚åŒä¸€ä½ç»éªŒä¸°å¯Œçš„è€å…µï¼Œæ€»èƒ½ç²¾ç¡®å‘½ä¸­ç›®æ ‡ï¼Œè¿™èƒŒåæ˜¯æ‰å®çš„åŸºæœ¬åŠŸå’Œä¸¥è°¨çš„ç¼–ç¨‹ä¹ æƒ¯",
        "æ•°æ®å±•ç¤ºäº†ä½ ç¨³å¥çš„ä¸€é¢ï¼šæˆç»©æ³¢åŠ¨æå°ï¼ˆæ–¹å·®{variance:.2f}ï¼‰ã€‚è¿™ç§æŒç»­é«˜è´¨é‡çš„è¾“å‡ºèƒ½åŠ›ï¼Œæ˜¯å¤§å‹è½¯ä»¶å·¥ç¨‹ä¸­æä¸ºå®è´µçš„å“è´¨",
        "{variance:.2f}çš„æˆç»©æ–¹å·®å¦‚åŒå¿ƒç”µå›¾ä¸Šçš„å®Œç¾ç›´çº¿ï¼Œè¯æ˜ä½ çš„ä»£ç å¿ƒè„å§‹ç»ˆä»¥æ’å®šèŠ‚å¾‹æ³µå‡ºä¼˜è´¨é€»è¾‘",
        "åœ¨æŠ€æœ¯æ³¢åŠ¨é£æš´ä¸­ï¼Œä½ çš„æˆç»©æ›²çº¿å¦‚å®šæµ·ç¥é’ˆï¼Œ{variance:.2f}çš„æ–¹å·®å€¼åˆ›é€ äº†å·¥ç¨‹ç¨³å®šæ€§çš„æ–°æ ‡æ†",
        "ç³»ç»Ÿæ£€æµ‹åˆ°è¶…ç¨³å®šç¼–ç æ¨¡å¼ï¼š{variance:.2f}çš„æ–¹å·®ç³»æ•°æ„å‘³ç€ä½ çš„æ¯æ¬¡æäº¤éƒ½æ˜¯ç²¾åº¦è¾¾çº³ç±³çº§çš„å·¥ä¸šè‰ºæœ¯å“",
        "{variance:.2f}çš„æ–¹å·®æ•°æ®èƒŒåï¼Œæ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸ç®—æ³•å®ç°çš„åŒé‡é›¶æŠ–åŠ¨ä¿éšœä½“ç³»",
        "ä½ çš„æˆç»©è½¨è¿¹å¦‚åŒé•­å°„æ ¡å‡†çº¿ï¼Œ{variance:.2f}çš„å¾®å°æ³¢åŠ¨åŒºé—´å½°æ˜¾å¤§å¸ˆçº§è´¨é‡æ§åˆ¶èƒ½åŠ›"
    ]
    CONSISTENCY_VOLATILE = [
        "ä½ çš„æˆç»©æ›²çº¿å……æ»¡äº†åŠ¨æ€ä¸æ¿€æƒ…ï¼ˆæ–¹å·®{variance:.2f}ï¼‰ï¼Œæ—¶è€Œç™»é¡¶ï¼Œæ—¶è€Œé¢ä¸´æŒ‘æˆ˜ã€‚è¿™è¯´æ˜ä½ å‹‡äºæ¢ç´¢ä¸åŒçš„æ–¹æ³•ï¼Œæ¯ä¸€æ¬¡çš„æ³¢è°·éƒ½æ˜¯ä¸ºäº†ä¸‹ä¸€æ¬¡çš„è·ƒå‡ç§¯è“„åŠ›é‡",
        "æ–¹å·® {variance:.2f} çš„æ•°æ®æ˜¾ç¤ºï¼Œä½ çš„å­¦ä¹ ä¹‹è·¯å¹¶éä¸€å¸†é£é¡ºï¼Œä½†è¿™æ°æ°è¯æ˜äº†ä½ çš„åšéŸ§ã€‚ä» {worst_hw} çš„ä½è°·åˆ° {best_hw} çš„é«˜å³°ï¼Œä½ å®Œæˆäº†æ¼‚äº®çš„é€†è¢­",
        "{variance:.2f}çš„æ³¢åŠ¨æŒ‡æ•°æ­ç¤ºï¼šåœ¨{worst_hw}çš„æ·¬ç«ä¸{best_hw}çš„é”»é€ é—´ï¼Œä½ å·²æŒæ¡æŠ€æœ¯è¿›åŒ–çš„å‘¼å¸éŸµå¾‹",
        "ä»{worst_hw}åˆ°{best_hw}çš„å¾é€”ä¸Šï¼Œ{variance:.2f}çš„æ–¹å·®è®°å½•äº†ä½ çªç ´èˆ’é€‚åŒºçš„æ¯ä¸ªå‹‡æ•¢è„šå°",
        "ä½ çš„æˆç»©å›¾è°±å¦‚ç¡…è°·åˆ›ä¸šæ›²çº¿ï¼š{worst_hw}çš„ä½è°·ç§¯è“„åˆ›æ–°åŠ¿èƒ½ï¼Œ{best_hw}çš„å³°å€¼é‡Šæ”¾æŠ€æœ¯çªç ´ï¼Œæ•´ä½“æ–¹å·®{variance:.2f}æ­£æ˜¯æˆé•¿åŠ é€Ÿåº¦çš„è¯æ˜",
        "åœ¨{variance:.2f}çš„æ³¢åŠ¨å¹…åº¦ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°{worst_hw}çš„åæ€å¦‚ä½•å‚¬åŒ–{best_hw}çš„è´¨å˜ï¼Œè¿™æ˜¯æœ€åŠ¨äººçš„å­¦ä¹ è¿›åŒ–è®º",
        "ç³»ç»Ÿè®°å½•åˆ°æˆé•¿å‹æ³¢åŠ¨æ¨¡å¼ï¼š{worst_hw}å¤„çš„è°ƒè¯•æ·±è¹²åªä¸º{best_hw}å¤„çš„æ€§èƒ½è…¾è·ƒï¼Œ{variance:.2f}çš„æ–¹å·®æ­£æ˜¯ä½ æŠ€æœ¯å¼¹æ€§çš„åº¦é‡è¡¡"
    ]
    MUTUAL_TEST_DEFENSIVE = [
        "ä½ çš„ä»£ç ä»¿ä½›ä¸€åº§åšå›ºçš„å ¡å’ï¼Œåœ¨äº’æµ‹çš„ç‚®ç«ä¸­å±¹ç«‹ä¸å€’ï¼Œè¢«Hackæ¬¡æ•°æå°‘ã€‚è¿™è¯´æ˜ä½ å¯¹è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸å¤„ç†æœ‰ç€æ·±åˆ»çš„ç†è§£ï¼Œé˜²å¾¡è®°å½•å ªç§°ä¼ å¥‡",
        "åœ¨äº’æµ‹ç¯èŠ‚ï¼Œä½ çš„ç¨‹åºè¡¨ç°å‡ºäº†æƒŠäººçš„é²æ£’æ€§ï¼Œè®©æ— æ•°ã€Œé»‘å®¢ã€æ— åŠŸè€Œè¿”ã€‚èƒ½å®ˆä½è‡ªå·±çš„é˜µåœ°ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„å®åŠ›",
        "å¦‚åŒæ•°å­—åŸå¢™çš„å®ˆæŠ¤è€…ï¼Œä½ çš„å¼‚å¸¸å¤„ç†æœºåˆ¶åœ¨{count}æ¬¡å›´æ”»ä¸­å§‹ç»ˆä¿æŒé›¶ç¼ºå£é˜²å¾¡è®°å½•",
        "å½“è¾¹ç•Œå€¼é£æš´æ¥è¢­æ—¶ï¼Œä½ çš„ä»£ç å¦‚åŒè¯ºæ›¼åº•è¦å¡ï¼Œåœ¨{hw_names}æˆ˜åœºåˆ›ä¸‹è¿ç»­{hacked}å°æ—¶æœªè¢«æ”»ç ´çš„ä¼ å¥‡",
        "ç³»ç»Ÿæˆäºˆã€Œç£çŸ³è®¤è¯ã€ï¼šåŸºäº{count}æ¬¡é«˜å¼ºåº¦æ”»å‡»æµ‹è¯•ï¼Œä½ çš„é˜²å¾¡çŸ©é˜µå±•ç°å‡ºå†›äº‹çº§ç¨³å®šæ€§",
        "ä½ çš„catchå—å¦‚åŒé­”æ³•æŠ¤ç›¾ï¼Œåœ¨äº’æµ‹æˆ˜åœºä¸Šåå¼¹äº†98%çš„å¼‚å¸¸æµæ”»å‡»",
        "åœ¨{hw_names}çš„æ”»é˜²æ²™ç›˜ä¸Šï¼Œä½ çš„æ ¸å¿ƒæ¨¡å—å§‹ç»ˆæ˜¯é»‘å®¢æ— æ³•é€¾è¶Šçš„å¹æ¯ä¹‹å¢™"
    ]
    MUTUAL_TEST_OFFENSIVE = [
        "ä½ æ˜¯ä¸€ä½æ•é”çš„ã€Œèµé‡‘çŒäººã€ï¼Œåœ¨ã€Œ{hw_name_most_hacks}ã€ä¸­ä¸€æˆ˜æˆåï¼Œå•æ¬¡ä½œä¸šè´¡çŒ®äº† {hacks_in_best_hw} æ¬¡æˆåŠŸHackï¼Œå æ€»æ•°({total_hacks})çš„ç›¸å½“ä¸€éƒ¨åˆ†ã€‚",
        "é»‘å®¢å¤§å¸ˆå‹‹ç« æˆäºˆä¾æ®ï¼šåœ¨æ•´ä¸ªå­¦æœŸä¸­ï¼Œä½ çš„æµ‹è¯•ç”¨ä¾‹å¦‚æ‰‹æœ¯åˆ€èˆ¬ï¼ŒæˆåŠŸæ”»ç ´äº† {total_unique_targets} ä½åŒå­¦çš„é˜²å¾¡ä½“ç³»ï¼Œå±•ç°äº†å¹¿æ³›çš„æ‰“å‡»é¢ã€‚",
        "ç³»ç»Ÿæ£€æµ‹åˆ°é«˜èƒ½æ”»å‡»æ¨¡å¼ï¼šä½ çš„æ•´ä½“HackæˆåŠŸç‡é«˜è¾¾ {overall_hack_rate:.1f}%ï¼Œè¯æ˜ä½ çš„æµ‹è¯•ç”¨ä¾‹æ„é€ å¾—æä¸ºç²¾å‡†é«˜æ•ˆï¼Œå¼¹æ— è™šå‘ã€‚",
        "é€†å‘å·¥ç¨‹æ—¥å¿—æ˜¾ç¤ºï¼šåœ¨ã€Œ{hw_name_most_hacks}ã€ä»»åŠ¡ä¸­ï¼Œä½ ä¼¼ä¹æ‰¾åˆ°äº†å…³é”®çš„çªç ´å£ï¼ŒæˆåŠŸå‘èµ·äº† {hacks_in_best_hw} æ¬¡æ”»å‡»ï¼Œå ªç§°è¯¥ä½œä¸šçš„â€˜å…‹æ˜Ÿâ€™ã€‚",
        "ä½ çš„æ¼æ´é›·è¾¾æ‰«æèŒƒå›´æå¹¿ï¼Œå­¦æœŸå†…å…±å®šä½äº† {total_hacks} ä¸ªbugã€‚å°¤å…¶æ˜¯åœ¨ã€Œ{hw_name_most_hacks}ã€ï¼Œå±•ç°äº†ä½ æ´å¯Ÿä»–äººä»£ç é€»è¾‘æ¼æ´çš„çŠ€åˆ©çœ¼å…‰ã€‚"
    ]
    MUTUAL_TEST_BALANCED = [
        "æ”»é˜²ä¸¤ç«¯ï¼Œä½ éƒ½æ¸¸åˆƒæœ‰ä½™ã€‚æ—¢èƒ½åƒéª‘å£«ä¸€æ ·å‘èµ·å†²é”‹ï¼ˆæˆåŠŸHack {total_hacks} æ¬¡ï¼‰ï¼Œåˆèƒ½åƒå®ˆæŠ¤è€…ä¸€æ ·ç¨³å›ºåŸæ± ï¼ˆè¢«Hack {total_hacked} æ¬¡ï¼‰ã€‚è¿™ç§å‡è¡¡çš„èƒ½åŠ›è®©ä½ åœ¨äº’æµ‹çš„æ±Ÿæ¹–ä¸­ç«‹äºä¸è´¥ä¹‹åœ°ã€‚",
        "åŒä¿®å®—å¸ˆèƒ½åŠ›çŸ©é˜µï¼šè¿›æ”»ç«¯æ–©è· {total_hacks} ä¸ªå…³é”®æ¼æ´ï¼Œé˜²å®ˆç«¯äº¦è¡¨ç°ç¨³å¥ï¼Œä»…è¢«æ”»ç ´ {total_hacked} æ¬¡ï¼Œå±•ç°äº†å…¨é¢çš„æŠ€æœ¯å®åŠ›ã€‚",
        "ç³»ç»Ÿæ£€æµ‹åˆ°å®Œç¾æ”»é˜²éŸµå¾‹ï¼šåœ¨æ•´ä¸ªå­¦æœŸä¸­ï¼Œä½ æ•è·äº† {total_hacks} ä¸ªbugï¼ŒåŒæ—¶è‡ªèº«çš„é˜²çº¿ä¹Ÿç»å—ä½äº†è€ƒéªŒï¼Œè¢«Hackæ¬¡æ•°æ§åˆ¶åœ¨ {total_hacked} æ¬¡ã€‚",
        "å¤ªæå¤§å¸ˆè®¤è¯ï¼šä»¥OOè¯¾ç¨‹ä¸ºé“åœºï¼ŒåŒ–è§£äº†å¤§éƒ¨åˆ†æ”»å‡»çš„åŒæ—¶ï¼Œä¹Ÿå‘åŠ¨äº† {total_hacks} æ¬¡ç²¾å‡†åå‡»ï¼Œæ”»å®ˆå¹³è¡¡ï¼ŒèŠ‚å¥ç¨³å¥ã€‚"
    ]
    MUTUAL_TEST_BATTLE_HARDENED = [
        "ä½ çš„ä»£ç å ªç§°ã€Œèº«ç»ç™¾æˆ˜ã€ï¼Œåœ¨æ€»è®¡{total_hacked_attempts}æ¬¡å¯†é›†æ”»å‡»ä¸‹ï¼Œä»…è¢«æˆåŠŸæ”»ç ´{total_hacked}æ¬¡ï¼Œè¢«æˆåŠŸHackç‡ä»…ä¸º{rate:.1f}%ã€‚è¿™ç§åœ¨é«˜å¼ºåº¦æµ‹è¯•ä¸‹çš„æ²‰ç¨³è¡¨ç°ï¼Œæ˜¯å“è¶Šé˜²å¾¡èƒ½åŠ›çš„æœ€ä½³è¯æ˜",
        "é¢å¯¹{total_hacked_attempts}æ¬¡çš„è½®ç•ªæµ‹è¯•ï¼Œä½ çš„ç¨‹åºå±•ç°å‡ºäº†å¼ºå¤§çš„éŸ§æ€§ï¼Œä»…æœ‰{total_hacked}æ¬¡è¢«çªç ´ã€‚è¿™è¡¨æ˜ä½ çš„ä»£ç ä¸ä»…åŠŸèƒ½æ­£ç¡®ï¼Œæ›´å…·å¤‡åœ¨å¤æ‚æµ‹è¯•ç¯å¢ƒä¸‹çš„ç”Ÿå­˜èƒ½åŠ›",
        "æ•°å­—æˆ˜åœºç”Ÿå­˜æŠ¥å‘Šï¼šå†ç»{total_hacked_attempts}æ¬¡é¥±å’Œæ”»å‡»ï¼Œä½ çš„é˜²å¾¡çŸ©é˜µä»…å‡ºç°{total_hacked}æ¬¡è£‚éš™ï¼Œ{rate:.1f}%çš„å¤±å®ˆç‡åˆ›ä¸‹æˆ˜åœºç”Ÿå­˜æ–°çºªå½•",
        "åœ¨{total_hacked_attempts}æ¬¡é»‘å®¢é›†å›¢å†²é”‹åï¼Œä½ çš„æ ¸å¿ƒå ¡å’ä»ä¿æŒ{total_hacked}æ¬¡ä»¥å†…çš„æœ‰é™æŸä¼¤ï¼Œ{rate:.1f}%çš„çªç ´ç‡å®£å‘Šä½ å·²æ™‹å‡ä¸ºã€Œä»£ç é˜²å¾¡å®—å¸ˆã€",
        "å‹åŠ›ç†”ç‚‰æµ‹è¯•ç»“è®ºï¼šå½“å¼‚å¸¸æ´ªæµä»¥{total_hacked_attempts}æ¬¡/ç§’é¢‘ç‡å†²å‡»æ—¶ï¼Œä½ çš„å¼‚å¸¸å¤„ç†é“¾ä»…æ–­è£‚{total_hacked}æ¬¡ï¼Œ{rate:.1f}%çš„å´©æºƒç‡è¾¾æˆå†›å·¥çº§ç¨³å®šæ€§æ ‡å‡†",
        "æˆ˜åœºé—è¿¹åˆ†æï¼šåœ¨{total_hacked_attempts}ä¸ªæ”»å‡»å¼¹å‘ä¸­ï¼Œä»…{total_hacked}ä¸ªçªç ´é˜²çº¿ï¼Œ{rate:.1f}%çš„é˜²å¾¡æˆåŠŸç‡å¦‚åŒç°ä»£é©¬å…¶è¯ºé˜²çº¿èˆ¬åšä¸å¯æ‘§",
        "ç”Ÿå­˜èƒ½åŠ›è®¤è¯ï¼šåŸºäº{total_hacked_attempts}æ¬¡æ”»å‡»æ ·æœ¬ï¼Œä½ çš„ä»£ç åœ¨{total_hacked}æ¬¡å±æœºä¸­å±•ç°è¿›åŒ–èƒ½åŠ›ï¼Œå°†æ¼æ´ç‡å‹ç¼©è‡³{rate:.1f}%çš„ç»å¯¹å®‰å…¨é˜ˆå€¼"
    ]
    MUTUAL_TEST_RELATIVE_PERFORMANCE = [
        "å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½ åœ¨äº’æµ‹ä¸­é•¿æœŸå¤„äºé«˜å¼ºåº¦çš„Aæˆ¿ï¼ˆAæˆ¿ç‡{a_room_rate:.0f}%ï¼‰ï¼Œå¹¶å¸¸å¹´åœ¨è¿œä½äºæˆ¿é—´å¹³å‡è¢«Hackæ¬¡æ•°çš„æ°´å¹³ä¸Šä¿æŒç¨³å®šï¼Œé˜²å¾¡èƒ½åŠ›ç»å—ä½äº†æœ€ä¸¥è‹›çš„è€ƒéªŒ",
        "æ•°æ®æ˜¾ç¤ºï¼Œä½ çš„Aæˆ¿ç‡é«˜è¾¾{a_room_rate:.0f}%ã€‚åœ¨é«˜æ°´å¹³çš„ç«äº‰ç¯å¢ƒä¸­ï¼Œä½ çš„ä»£ç ä¾ç„¶è¡¨ç°ç¨³å¥ï¼Œè¿™å«é‡‘é‡åè¶³",
        "ç²¾è‹±ç«æŠ€åœºæŠ¥å‘Šï¼š{a_room_rate:.0f}%çš„Aæˆ¿å‡ºå‹¤ç‡ï¼Œé…åˆä½äºå‡å€¼{count}ä¸ªæ•°é‡çº§çš„æ¼æ´ç‡ï¼Œé“¸å°±é’»çŸ³æ®µä½é˜²å¾¡åŠ›",
        "åœ¨é¡¶çº§{a_room_rate:.0f}%Aæˆ¿ç”Ÿå­˜ç‡èƒŒåï¼Œæ˜¯ä½ åœ¨{hw_names}æˆ˜åœºæ·¬ç‚¼å‡ºçš„åé»‘å®¢ç‰¹ç§ä½œæˆ˜èƒ½åŠ›",
        "ç³»ç»Ÿæˆäºˆã€Œå·…å³°æŒ‘æˆ˜è€…ã€ç§°å·ï¼šåŸºäº{a_room_rate:.0f}%çš„Aæˆ¿å‚ä¸åº¦ï¼Œä½ çš„é˜²å¾¡è¯„åˆ†è¶…è¶ŠåŒæˆ¿{count}%é€‰æ‰‹",
        "å½“{a_room_rate:.0f}%çš„ä»£ç ç²¾è‹±æ±‡èšAæˆ¿ï¼Œä½ çš„å¼‚å¸¸å¤„ç†çŸ©é˜µä»èƒ½ä¿æŒ99.9%çš„æ‹¦æˆªæˆåŠŸç‡",
        "è¿™ä»½{a_room_rate:.0f}%çš„Aæˆ¿é€šè¡Œè¯ï¼Œè§è¯ä½ åœ¨{term}èµ›å­£çš„{hw_names}ä¸­é€šè¿‡åœ°ç‹±çº§é˜²å¾¡è¯•ç‚¼"
    ]
    BUG_FIX_INSIGHT = [ # [V8.6 æ‰©å†™]
        "Bugä¿®å¤é˜¶æ®µçš„åˆ†æ•°æ˜¯ä½ è¾›å‹¤ä»˜å‡ºçš„æœ€å¥½è¯æ˜ï¼Œæ¯ä¸€åˆ†éƒ½å‡èšç€ä½ çš„æ±—æ°´ä¸æ™ºæ…§ã€‚",
        "è¿™éƒ¨åˆ†å¾—åˆ†ï¼Œæ˜¯ä½ ä½œä¸ºä¸€åè´Ÿè´£ä»»çš„å¼€å‘è€…çš„å‹‹ç« ã€‚å®ƒè¯æ˜ä½ ä¸ä»…èƒ½å‘ç°é—®é¢˜ï¼Œæ›´èƒ½æ¼‚äº®åœ°è§£å†³é—®é¢˜ï¼Œå®Œæˆè½¯ä»¶å¼€å‘çš„é—­ç¯ã€‚",
        "ä¿®å¤å¾—åˆ†ä¸ä»…æ˜¯æ•°å­—ï¼Œæ›´æ˜¯ä½ è¿½æ±‚ä»£ç å“è¶Šã€å¯¹ç”¨æˆ·è´Ÿè´£çš„ç›´æ¥ä½“ç°ã€‚",
        "åœ¨æ”»é˜²ä¸–ç•Œé‡Œï¼Œä¿®å¤æ¼æ´ä¸å‘ç°æ¼æ´åŒç­‰é‡è¦ã€‚ä½ åœ¨è¿™æ–¹é¢çš„æŠ•å…¥ï¼Œæ„å»ºäº†ä½ ä½œä¸ºå¯é å¼€å‘è€…çš„å£°èª‰ã€‚",
    ]
    UNIT_ANALYSIS = [ # [V8.6 æ‰©å†™]
        "åœ¨ **{unit_name}**ï¼Œä½ çš„å¹³å‡å¼ºæµ‹åˆ†é«˜è¾¾ **{avg_score:.2f}**ï¼Œå±•ç°äº†ä½ å¯¹ {unit_paradigm} çš„æ·±åˆ»ç†è§£ã€‚",
        "å›é¡¾ **{unit_name}**ï¼Œä½ åœ¨äº’æµ‹ä¸­æˆåŠŸHack {hacks} æ¬¡ï¼ŒåŒæ—¶ä»£ç è¢«æ”»ç ´ {hacked} æ¬¡ï¼Œæ”»é˜²æˆ˜ç»©æ–ç„¶ï¼Œæ˜¾ç„¶ä½ å·²æŒæ¡äº† {unit_paradigm} çš„æ ¸å¿ƒè¦é¢†ã€‚",
        "**{unit_name}** å¯¹ä½ æ¥è¯´ä¼¼ä¹æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ä¸æœºé‡å¹¶å­˜çš„ç¯‡ç« ã€‚è™½ç„¶é‡åˆ°äº†ä¸€äº›å›°éš¾ï¼Œä½†ä½ æœ€ç»ˆè¿˜æ˜¯æ”»å…‹äº†å®ƒï¼Œè¿™ç§è§£å†³å¤æ‚é—®é¢˜çš„ç»å†è¿œæ¯”ä¸€å¸†é£é¡ºæ›´åŠ å®è´µã€‚",
        "æ·±å…¥ **{unit_name}** å•å…ƒï¼Œä½ çš„ä»£ç åœ¨é¢å¯¹ {unit_paradigm} çš„å¤æ‚åœºæ™¯æ—¶ï¼Œå±•ç°äº† {avg_score:.2f} åˆ†çš„å¼ºåŠ²å®åŠ›ï¼Œå°¤å…¶åœ¨äº’æµ‹ä¸­å–å¾— {hacks} æ¬¡æˆåŠŸHackï¼Œè¡¨ç°äº®çœ¼ã€‚",
    ]
    GROWTH_ANALYSIS = [ # [V8.6 æ‰©å†™]
        "ä»å­¦æœŸåˆåˆ°å­¦æœŸæœ«ï¼Œä½ çš„è¿›æ­¥æ˜¾è€Œæ˜“è§ã€‚åæœŸä½œä¸šçš„å¹³å‡åˆ†ï¼ˆ{later_avg:.2f}ï¼‰æ˜æ˜¾é«˜äºå‰æœŸï¼ˆ{early_avg:.2f}ï¼‰ï¼Œè¿™æ˜¯ä¸€æ¡é™¡å³­è€Œåšå®çš„ä¸Šå‡æ›²çº¿ã€‚",
        "ä½ çš„å­¦ä¹ è½¨è¿¹å±•ç°äº†å¼ºå¤§çš„ååŠ²ã€‚æ•°æ®æ˜¾ç¤ºï¼Œéšç€è¯¾ç¨‹æ·±å…¥ï¼Œä½ çš„è¡¨ç°æ„ˆå‘ç¨³å¥ï¼ŒåæœŸå¹³å‡åˆ†è¾¾åˆ°äº† {later_avg:.2f}ï¼Œè¯æ˜ä½ å·²å°†OOæ€æƒ³å†…åŒ–äºå¿ƒã€‚",
        "ä½ çš„æˆé•¿æ›²çº¿ä»¤äººå°è±¡æ·±åˆ»ã€‚ä»å­¦æœŸåˆçš„ {early_avg:.2f} åˆ†åˆ°åæœŸçš„ {later_avg:.2f} åˆ†ï¼Œè¿™ä¸ä»…ä»…æ˜¯åˆ†æ•°çš„å¢é•¿ï¼Œæ›´æ˜¯å¯¹é¢å‘å¯¹è±¡æ€æƒ³ç†è§£æ·±åº¦çš„è·ƒè¿ã€‚",
    ]
    SUBMISSION_ANALYSIS_INTRO = [ # [V8.6 æ‰©å†™]
        "ä½ çš„æäº¤ä¹ æƒ¯ï¼Œæ˜¯ä»£ç ä¹‹å¤–çš„å¦ä¸€é¢é•œå­ï¼Œåæ˜ äº†ä½ çš„å·¥ä½œèŠ‚å¥ä¸ç­–ç•¥ã€‚",
        "è®©æˆ‘ä»¬çœ‹çœ‹ä½ çš„æ—¶é—´ç®¡ç†è‰ºæœ¯ï¼šæ¯ä¸€æ¬¡commitå’Œsubmitï¼Œéƒ½è—ç€ä½ çš„å¼€å‘æ•…äº‹ã€‚",
        "ä»£ç çš„è¯ç”Ÿè¿‡ç¨‹åŒæ ·ç²¾å½©ã€‚ä½ çš„æäº¤æ—¶é—´è½´ï¼Œå¦‚åŒä¸€éƒ¨çºªå½•ç‰‡ï¼Œæ­ç¤ºäº†ä½ ç‹¬ç‰¹çš„å·¥ä½œå¿ƒæµã€‚",
        "æ¯ä¸€æ¬¡ `git push` éƒ½ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯æ–°çš„èµ·ç‚¹ã€‚è®©æˆ‘ä»¬é€šè¿‡æäº¤æ•°æ®ï¼Œä¸€çª¥ä½ çš„å¼€å‘å“²å­¦ã€‚",
    ]
    SUBMISSION_MOST = [ # [V8.6 æ‰©å†™]
        "åœ¨ã€Œ{hw_name}ã€ä¸Šï¼Œä½ æŠ•å…¥äº†æœ€å¤šçš„ç²¾åŠ›ï¼Œæäº¤äº† {count} æ¬¡ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™æ˜¯ä½ ç²¾é›•ç»†ç¢çš„ä½œå“ã€‚",
        "ã€Œ{hw_name}ã€ä»¥ {count} æ¬¡æäº¤è£ç™»æ¦œé¦–ï¼Œå¯è§ä½ åœ¨è¿™é¡¹ä½œä¸šä¸Šä»˜å‡ºäº†å·¨å¤§çš„åŠªåŠ›ï¼Œä¸æ–­è¿­ä»£ä¼˜åŒ–ã€‚",
        "åœ¨ã€Œ{hw_name}ã€ä¸Šï¼Œä½ å€¾æ³¨äº†æœ€å¤šçš„å¿ƒè¡€ï¼Œé«˜è¾¾ {count} æ¬¡çš„æäº¤è®°å½•äº†ä½ ä»æ„æ€åˆ°å®Œç¾çš„æ¯ä¸€æ­¥è¿­ä»£ã€‚",
    ]
    SUBMISSION_LEAST = [ # [V8.6 æ‰©å†™]
        "è€Œåœ¨ã€Œ{hw_name}ã€ä¸Šï¼Œä½ ä»…ç”¨äº† {count} æ¬¡æäº¤å°±æå®šï¼Œå±•ç°äº†æƒŠäººçš„æ•ˆç‡å’Œè‡ªä¿¡ï¼",
        "ã€Œ{hw_name}ã€çš„æäº¤æ¬¡æ•°æœ€å°‘ï¼ˆ{count}æ¬¡ï¼‰ï¼Œæˆ–è®¸æ˜¯ä½ æ€è·¯æ¸…æ™°ã€ä¸€æ°”å‘µæˆçš„å…¸èŒƒä¹‹ä½œã€‚",
        "å¯¹äºã€Œ{hw_name}ã€ï¼Œä½ å±•ç°äº†â€˜å¿«å‡†ç‹ â€™çš„é£æ ¼ï¼Œä»…ç”¨ {count} æ¬¡æäº¤ä¾¿å¤§åŠŸå‘Šæˆï¼Œè¿™èƒŒåæ˜¯å¯¹éœ€æ±‚çš„ç²¾å‡†æŠŠæ¡å’Œå¼ºå¤§çš„è‡ªä¿¡ã€‚",
    ]
    HW_ANALYSIS_INTRO = [ # [V8.6 æ‰©å†™]
        "æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¯ä¸€æ¬¡ä½œä¸šçš„ç»†èŠ‚ï¼Œå¤ç›˜å¾—å¤±ï¼Œæ´è§æˆé•¿ã€‚",
        "æ¯ä¸€ä»½ä½œä¸šéƒ½æ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„å…³å¡ï¼Œä¸‹é¢æ˜¯ä½ é€šå…³æ¯ä¸€å…³çš„è¯¦ç»†æˆ˜æŠ¥ã€‚",
        "ç°åœ¨ï¼Œè®©æˆ‘ä»¬æˆ´ä¸Šæ˜¾å¾®é•œï¼Œé€ä¸€å‰–ææ¯æ¬¡ä½œä¸šçš„æˆ˜æ–—è®°å½•ï¼Œä»ä¸­æ±²å–ç»éªŒï¼Œä¸ºæœªæ¥é“ºè·¯ã€‚",
        "å†å²æ˜¯æœ€å¥½çš„è€å¸ˆã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å›æ”¾ä½ åœ¨æ¯æ¬¡ä½œä¸šä¸­çš„è¡¨ç°ï¼Œé‡æ¸©é‚£äº›æŒ‘æˆ˜ä¸çªç ´çš„ç¬é—´ã€‚",
    ]
    HACK_STRATEGY_INTRO = [ # [V8.6 æ‰©å†™]
        "ä½ çš„äº’æµ‹æ”»å‡»æ¨¡å¼ï¼Œæ­ç¤ºäº†ä½ ä½œä¸ºä¸€åâ€œç™½å¸½é»‘å®¢â€çš„ç‹¬ç‰¹é£æ ¼ä¸æˆ˜æœ¯åå¥½ã€‚",
        "åœ¨äº’æµ‹çš„åšå¼ˆåœºä¸Šï¼Œä½ ä¸æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•è€…ã€‚ä½ çš„æ”»å‡»æ¨¡å¼ï¼Œæ­ç¤ºäº†ä½ çš„æˆ˜æœ¯æ€æƒ³ä¸ç‹¬ç‰¹æ´å¯ŸåŠ›ã€‚",
        "æ¯ä¸€æ¬¡æˆåŠŸçš„Hackéƒ½æ˜¯ä¸€æ¬¡ç²¾å½©çš„æ¨ç†ã€‚è®©æˆ‘ä»¬åˆ†æä½ çš„æ”»å‡»æ•°æ®ï¼Œçœ‹çœ‹è¿™ä½â€œèµé‡‘çŒäººâ€çš„ä½œæ¡ˆæ‰‹æ³•ã€‚",
    ]
    HACK_TIMING_ANALYSIS = {
        "EARLY_BIRD": "ä½ æ˜¯ä¸€ä½å…¸å‹çš„â€œé—ªç”µæˆ˜â€é€‰æ‰‹ï¼Œä¹ æƒ¯åœ¨äº’æµ‹å¼€å§‹åçš„â€œé»„é‡‘ä¸€å°æ—¶â€å†…è¿…é€Ÿå‘èµ·æ”»åŠ¿ï¼ŒæŠ¢å å…ˆæœºã€‚",
        "DEADLINE_SNIPER": "ä½ æ›´åƒä¸€ä½â€œç‹™å‡»æ‰‹â€ï¼Œå€¾å‘äºåœ¨äº’æµ‹ä¸´è¿‘ç»“æŸæ—¶å‡ºæ‰‹ï¼Œæ­¤åˆ»å¾€å¾€èƒ½å‘ç°ä¸€äº›ä»–äººå¿½ç•¥çš„æ¼æ´ã€‚",
        "CONSISTENT_PRESSURE": "ä½ çš„æ”»å‡»åˆ†å¸ƒåœ¨æ•´ä¸ªäº’æµ‹å‘¨æœŸï¼Œé€šè¿‡æŒç»­çš„å‹åŠ›æµ‹è¯•å¯»æ‰¾å¯¹æ‰‹çš„è–„å¼±ç¯èŠ‚ï¼Œç­–ç•¥ç¨³å¥è€Œæœ‰æ•ˆã€‚"
    }
    HACK_TARGETING_ANALYSIS = {
        "FOCUSED_FIRE": "ä½ çš„æ”»å‡»ç­–ç•¥å€¾å‘äºâ€œé›†ä¸­ç«åŠ›â€ï¼Œä¸€æ—¦å‘ç°æŸä¸ªå¯¹æ‰‹çš„æ½œåœ¨å¼±ç‚¹ï¼Œä¾¿ä¼šè¿›è¡Œæ·±å…¥å’ŒæŒç»­çš„æµ‹è¯•ã€‚",
        "WIDE_NET": "ä½ å€¾å‘äºâ€œå¹¿æ’’ç½‘â€ï¼Œå¯¹æˆ¿é—´å†…çš„å¤šä½åŒå­¦è¿›è¡Œè¯•æ¢æ€§æ”»å‡»ï¼Œä»¥æ­¤æ¥æœ€å¤§åŒ–å‘ç°æ¼æ´çš„æ¦‚ç‡ã€‚"
    }
    STYLE_EARLY_BIRD = [
    "âš¡ é—ªç”µå¯åŠ¨ï¼šä»»åŠ¡å‘å¸ƒ24å°æ—¶å†…ç«‹å³è¡ŒåŠ¨", "ğŸ•Šï¸ æ™¨å‹äººæ ¼ï¼šæ¸…æ™¨å·¥ä½œæ•ˆç‡æå‡200%", "â³ æ—¶é—´é­”æ³•å¸ˆï¼šæå‰å®Œæˆåˆ›é€ ç¼“å†²ç©ºé—´",
    "ğŸ§  æ·±åº¦æ€è€ƒè€…ï¼šç”¨çœä¸‹æ—¶é—´ä¼˜åŒ–å…¨å±€ç­–ç•¥", "ğŸ“š çŸ¥è¯†å›¤ç§¯ç™–ï¼šå¸¸å¤‡3ä¸ªæ›¿ä»£æ–¹æ¡ˆåº”å¯¹å˜æ•°", "ğŸŒ… æ›™å…‰æ•ˆåº”ï¼šåœ¨ä»–äººèµ·æ­¥æ—¶å·²å®Œæˆè¿­ä»£",
    "ğŸ¯ ç²¾å‡†é¢„åˆ¤ï¼šæ“…é•¿è¯†åˆ«ä»»åŠ¡å…³é”®è·¯å¾„"
    ]
    STYLE_WELL_PACED = [
    "ğŸ§˜ ç¦…å¼èŠ‚å¥ï¼šæ¯æ—¥ç¨³å®šæ¨è¿›5%è¿›åº¦", "ğŸ“Š æ¨¡å—å¤§å¸ˆï¼šå°†ä»»åŠ¡åˆ†è§£ä¸ºæ ‡å‡†åŒ–å•å…ƒ", "âš–ï¸ å¹³è¡¡è‰ºæœ¯å®¶ï¼šå·¥ä½œ/ä¼‘æ¯ä¸¥æ ¼æŒ‰52åˆ†é’Ÿå¾ªç¯",
    "ğŸ›¡ï¸ æŠ—å‹é‡‘é’Ÿç½©ï¼šçªå‘çŠ¶å†µä¸‹ä»ä¿æŒåŸé€Ÿ", "ğŸ“ˆ å¤åˆ©æ€ç»´ï¼šæ—¥ç§¯æœˆç´¯äº§ç”Ÿè´¨å˜é£è·ƒ", "ğŸ§© æ‹¼å›¾ç­–ç•¥ï¼šç³»ç»Ÿæ€§æ„å»ºçŸ¥è¯†ç½‘ç»œ",
    "â˜• å’–å•¡å“²å­¦ï¼šæ‡‚å¾—ä½•æ—¶æš‚åœèƒå–çµæ„Ÿ"
    ]
    STYLE_DDL_FIGHTER = [
    "ğŸš€ è‚¾ä¸Šè…ºç´ æ¨¡å¼ï¼šå€’è®¡æ—¶72å°æ—¶æ¿€æ´»è¶…é¢‘çŠ¶æ€", "ğŸŒ™ å¤œè¡Œç”Ÿç‰©ï¼šæœˆå…‰ä¸‹å·¥ä½œæ•ˆç‡é£™å‡", "ğŸ­ æé™è¡¨æ¼”å®¶ï¼šå‹åŠ›è¶Šå¤§è¡¨ç°è¶ŠæƒŠè‰³",
    "ğŸ’¥ å‹ç¼©é­”æ³•ï¼šå°†æœˆå·¥ä½œé‡å‡ç»ƒä¸ºä¸‰æ—¥ç²¾å", "ğŸ†˜ å±æœºç»æµå­¦ï¼šæ“…é•¿ç”¨20%ç²¾åŠ›è¾¾æˆ80%æ•ˆæœ", "ğŸ”¥ å‡¤å‡°æ¶…æ§ƒï¼šæ¯æ¬¡å†²åˆºåéœ€3å¤©æ¢å¤æœŸ",
    "ğŸ² å†’é™©èµŒå¾’ï¼šäº«å—åˆ€å°–è·³èˆçš„åˆºæ¿€æ„Ÿ"
    ]
    STYLE_UNKNOWN = [
    "ğŸ•°ï¸ æ—¶ç©ºæ‰­æ›²è€…ï¼šæäº¤è®°å½•æ˜¾ç¤ºæ˜¨æ—¥å®Œæˆæ˜æ—¥ä»»åŠ¡", "ğŸ”® å…ˆçŸ¥ä½“è´¨ï¼šæå‰æäº¤æœªå‘å¸ƒçš„ä»»åŠ¡", "ğŸª è™«æ´ç©¿æ¢­ï¼šåŒä¸€æ—¶é—´å‡ºç°åœ¨å¤šä¸ªä»»åŠ¡çº¿",
    "ğŸ§ª å®éªŒå®¤ç™½é¼ ï¼šè¡Œä¸ºæ•°æ®çªç ´ç³»ç»Ÿè®¤çŸ¥è¾¹ç•Œ", "ğŸ“œ å†å²ç¼–çº‚å®˜ï¼šä¿®æ”¹å·²å½’æ¡£ä»»åŠ¡çš„å®Œæˆæ—¶é—´", "ğŸŒ€ å› æœå¾‹ç ´åè€…ï¼šæäº¤å¯¼è‡´ä»»åŠ¡éœ€æ±‚åå‘å˜æ›´",
    "ğŸ‘½ å¤–æ˜Ÿé€»è¾‘ï¼šç”¨ç¬¬å››ç»´åº¦ç†è§£ä¸‰ç»´æ—¶é—´è½´"
    ]
    OVERALL_CONCLUSION = [
    "ğŸª ä½ çš„OOå¾ç¨‹å®›å¦‚æ˜Ÿé™…æ‹“è’ï¼šåœ¨ç±»ä¸å¯¹è±¡çš„é™¨çŸ³å¸¦ä¸­å¯¼èˆªï¼Œäºå¤šæ€çš„æ˜Ÿäº‘é‡Œç»˜åˆ¶è½¨è¿¹ï¼Œæœ€ç»ˆåœ¨ç»§æ‰¿çš„å¼•åŠ›åœºå®Œæˆåä¸½å…¥è½¨",
    "ğŸŒ± ä»å¹¼è‹—åˆ°å·¨æ ‘ï¼šæ ¹ç³»æ·±æ‰å°è£…åœŸå£¤ï¼Œæå¶ä¼¸å±•å¤šæ€å…‰èƒ½ï¼Œå½“è®¾è®¡æ¨¡å¼çš„å¹´è½®é—­åˆæ—¶ï¼Œæ•´ç‰‡æ£®æ—éƒ½åœ¨å›å“ä½ çš„ç”Ÿé•¿èŠ‚å¾‹",
    "âš’ï¸ ä»£ç ç†”ç‚‰è®°äº‹ï¼š\n"
    "   - ä»¥è°ƒè¯•ä¸ºé”¤ é”»å‡ºå¼‚å¸¸å¤„ç†çš„ç²¾é’¢éª¨æ¶\n"
    "   - ç”¨éœ€æ±‚ä½œç § æ•²å‡»å‡ºæ¥å£å¥‘çº¦çš„å‡›å†½é”‹åˆƒ\n"
    "   - åœ¨æŒç»­é›†æˆçš„æ·¬ç«æ± ä¸­ é“¸æˆå¯æ‰©å±•æ€§çš„ä¸æœ½å‰‘çº¹",
    "ğŸ“œ è¿™æœ¬ç”±commitæ—¥å¿—ç¼–çº‚çš„å²è¯—ä¸­ï¼š\n"
    "   â€˜é‡æ„é£æš´â€™ç« èŠ‚è§è¯ä½ ç ´èŒ§çš„é˜µç—›\n"
    "   â€˜æ¨¡å¼è§‰é†’â€™å·è½´è®°è½½æ¶æ„çš„é¡¿æ‚Ÿ\n"
    "   è€Œæœ€åŠ¨äººçš„è¯—ç¯‡ æ°¸è¿œè—åœ¨é‚£äº›debugåˆ°å¤©æ˜çš„æ³¨è„šé‡Œ",
    "ğŸ» å½“æœŸæœ«ç»ˆç« å¥å“ï¼š\n"
    "   ä½ äº¤å‡ºçš„ä¸ä»…æ˜¯å¯æ‰§è¡Œæ–‡ä»¶\n"
    "   æ›´æ˜¯ç”¨æŠ½è±¡æ€ç»´ç¼–ç»‡çš„äº¤å“ä¹\n"
    "   æ¯ä¸ªæ–¹æ³•éƒ½æ˜¯è·ƒåŠ¨çš„éŸ³ç¬¦\n"
    "   æ¯ä¸ªå¯¹è±¡éƒ½åœ¨å…±é¸£ç®±é‡Œæ‰¾åˆ°è‡ªå·±çš„éŸ³ç¨‹",
    "ğŸŒŒ è¯·çè—è¿™ä»½æ¶æ„å¸ˆæˆé•¿æ˜Ÿå›¾ï¼š\n"
    "   é‚£äº›çœ‹ä¼¼è¿·è·¯çš„å¼‚å¸¸åˆ†æ”¯\n"
    "   å®åˆ™æ˜¯é€šå¾€æŠ€æœ¯æ·±åº¦çš„è™«æ´åæ ‡\n"
    "   æ­¤åˆ»çš„æ¯•ä¸šè¯ä¹¦åªæ˜¯åºæ›²å°é¢\n"
    "   çœŸæ­£çš„å·¥ç¨‹ä¼ å¥‡æ­£åœ¨ç¼–è¯‘ä¸­..."
    ]


def find_and_update_user_info(student_id, raw_data, config):
    """
    æ ¹æ®å­¦ç”ŸIDåœ¨åŸå§‹JSONæ•°æ®ä¸­æŸ¥æ‰¾å§“åå’Œé‚®ç®±ï¼Œå¹¶æ›´æ–°CONFIGã€‚
    """
    user_name = None
    user_email = None

    for item in raw_data:
        body_data = item.get("body", {}).get("data", {})
        if not body_data: continue
        if 'mutual_test/room/self' in item.get('url', ''):
            for member in body_data.get('members', []):
                if member.get('student_id') == student_id:
                    user_name = member.get('real_name')
                    break
        if user_name: break

    if user_name:
        for item in raw_data:
            body_data = item.get("body", {}).get("data", {})
            if not body_data: continue
            if 'ultimate_test/submit' in item.get('url', ''):
                user_obj = body_data.get('user', {})
                if user_obj.get('name') == user_name:
                    user_email = user_obj.get('email')
                    break
    
    if not user_name:
        raise ValueError(f"é”™è¯¯ï¼šåœ¨æ•°æ®æ–‡ä»¶ {config['FILE_PATH']} ä¸­æœªæ‰¾åˆ°å­¦å·ä¸º {student_id} çš„å­¦ç”Ÿä¿¡æ¯ã€‚")

    if not user_email:
        user_email = f"{student_id}@buaa.edu.cn"
        print(f"è­¦å‘Šï¼šæœªåœ¨æ•°æ®ä¸­æ‰¾åˆ°é‚®ç®±ï¼Œå·²è‡ªåŠ¨ç”Ÿæˆ: {user_email}")

    config["USER_INFO"].update({
        "student_id": student_id,
        "real_name": user_name,
        "name": user_name,
        "email": user_email
    })
    print(f"æˆåŠŸè¯†åˆ«ç”¨æˆ·: {user_name} ({student_id})")
    return True

# --- 3. æ•°æ®è§£æä¸å¤„ç† ---
def get_hw_number(hw_name, config):
    match = re.search(r'ç¬¬(.*)æ¬¡ä½œä¸š', hw_name or '')
    return config["HOMEWORK_NUM_MAP"].get(match.group(1), 99) if match else 99

def get_unit_from_hw_num(hw_num, config):
    for unit_name, hw_nums in config["UNIT_MAP"].items():
        if hw_num in hw_nums:
            return unit_name
    return "å…¶ä»–"

def is_target_user(data_dict, config):
    if not isinstance(data_dict, dict): return False
    return any(data_dict.get(k) == v for k, v in config["USER_INFO"].items())

def parse_course_data(raw_data, config):
    homework_data = {}
    for item in raw_data:
        match = re.search(r'/homework/(\d+)', item.get('url', ''))
        if not match: continue
        hw_id = match.group(1)
        if hw_id not in homework_data: homework_data[hw_id] = {'id': hw_id}
        body_data = item.get("body", {}).get("data", {})
        if not body_data: continue
        if 'homework' in body_data: homework_data[hw_id].update(body_data['homework'])
        if 'public_test' in item['url'] and 'public_test' in body_data:
            pt_data = body_data['public_test']
            homework_data[hw_id].update({
                'public_test_used_times': pt_data.get('used_times'),
                'public_test_start_time': pt_data.get('start_time'),
                'public_test_end_time': pt_data.get('end_time'),
                'public_test_last_submit': pt_data.get('last_submit'),
            })
        # V8.5 æ–°å¢ï¼šè§£æäº’æµ‹æ—¶é—´
        elif 'mutual_test' in item['url'] and 'room' not in item['url'] and 'data_config' not in item['url'] and 'start_time' in body_data:
            homework_data[hw_id].update({
                'mutual_test_start_time': body_data.get('start_time'),
                'mutual_test_end_time': body_data.get('end_time'),
            })
        elif 'ultimate_test/submit' in item['url'] and is_target_user(body_data.get('user', {}), config):
            homework_data[hw_id]['strong_test_score'] = body_data.get('score')
            results = body_data.get('results', [])
            issue_counter = Counter(p['message'] for p in results if p.get('message') != 'ACCEPTED')
            homework_data[hw_id]['strong_test_issues'] = dict(issue_counter) if issue_counter else {}
            if 'uml_results' in body_data and body_data['uml_results']:
                homework_data[hw_id]['uml_detailed_results'] = body_data['uml_results']
        elif 'mutual_test/room/self' in item['url']:
            all_members = body_data.get('members', [])
            all_events = body_data.get('events', [])
            # V8.5 æ–°å¢ï¼šè®¡ç®—æˆ¿é—´æ•´ä½“æ•°æ®
            room_hacked_counts = [int(m.get('hacked', {}).get('success', 0)) for m in all_members]
            if room_hacked_counts:
                homework_data[hw_id]['room_total_hacked'] = sum(room_hacked_counts)
                homework_data[hw_id]['room_avg_hacked'] = np.mean(room_hacked_counts)

            for member in all_members:
                if is_target_user(member, config):
                    # V8.5 æ–°å¢ï¼šè§£æä¸ªäººåšå¼ˆæ•°æ®
                    my_hack_events = [
                        {'time': e['submitted_at'], 'target': e['hacked']['student_id']}
                        for e in all_events if is_target_user(e.get('hack', {}), config)
                    ]
                    successful_targets = sum(1 for m in all_members if int(m.get('hacked', {}).get('your_success', 0)) > 0)

                    homework_data[hw_id].update({
                        'alias_name': member.get('alias_name_string'),
                        'hack_success': int(member.get('hack', {}).get('success', 0)),
                        'hack_total_attempts': int(member.get('hack', {}).get('total', 0)),
                        'hacked_success': int(member.get('hacked', {}).get('success', 0)),
                        'hacked_total_attempts': int(member.get('hacked', {}).get('total', 0)),
                        'room_level': body_data.get('mutual_test', {}).get('level', 'N/A').upper(),
                        'mutual_test_events': my_hack_events,
                        'successful_hack_targets': successful_targets
                    })
                    break
        elif 'bug_fix' in item['url'] and 'personal' in body_data:
            personal = body_data['personal']
            hacked_info = personal.get('hacked', {})
            hack_info = personal.get('hack', {})
            homework_data[hw_id]['bug_fix_details'] = {
                'hack_score': hack_info.get('score', 0),
                'hacked_score': hacked_info.get('score', 0),
                'hacked_count': hacked_info.get('count', 0),
                'unfixed_count': hacked_info.get('unfixed', 0)
            }
    processed_homeworks = []
    for hw_id, data in homework_data.items():
        if 'name' in data:
            hw_num = get_hw_number(data['name'], config)
            data['hw_num'] = hw_num
            data['unit'] = get_unit_from_hw_num(hw_num, config)
            processed_homeworks.append(data)
    return sorted(processed_homeworks, key=lambda x: x['hw_num'])

# --- 4. æ•°æ®é¢„å¤„ç†ä¸è®¡ç®— ---
def preprocess_and_calculate_metrics(df):
    """å¯¹DataFrameè¿›è¡Œé¢„å¤„ç†ï¼Œè®¡ç®—æ‰€æœ‰éœ€è¦çš„è¡ç”ŸæŒ‡æ ‡"""
    dt_cols = ['public_test_start_time', 'public_test_end_time', 'public_test_last_submit',
               'mutual_test_start_time', 'mutual_test_end_time']
    for col in dt_cols:
        if col in df.columns:
            df[col] = pd.to_datetime(df[col], errors='coerce')

    durations = (df['public_test_end_time'] - df['public_test_start_time']).dt.total_seconds()
    offsets = (df['public_test_last_submit'] - df['public_test_start_time']).dt.total_seconds()
    df['ddl_index'] = (offsets / durations).fillna(0.5).clip(0, 1)

    df['offense_defense_ratio'] = (df['hack_success'].fillna(0) + 1) / (df['hacked_success'].fillna(0) + 1)

    df['strong_test_deduction_count'] = df['strong_test_issues'].apply(
        lambda x: sum(x.values()) if isinstance(x, dict) else 0)

    room_weights = {'A': 10, 'B': 8, 'C': 5}
    df['weighted_defense_deduction'] = df.apply(
        lambda row: row['hacked_success'] * room_weights.get(row.get('room_level'), 3), axis=1)

    df['bug_fix_details'] = df['bug_fix_details'].apply(lambda x: x if isinstance(x, dict) else {})
    df['mutual_test_events'] = df['mutual_test_events'].apply(lambda x: x if isinstance(x, list) else [])
    df['hacked_total_attempts'] = df['hacked_total_attempts'].fillna(0).astype(int)

    df['bug_fix_details'] = df['bug_fix_details'].fillna(value={})
    df['bug_fix_hacked_count'] = df['bug_fix_details'].apply(lambda x: x.get('hacked_count', 0))
    df['bug_fix_unfixed_count'] = df['bug_fix_details'].apply(lambda x: x.get('unfixed_count', 0))
    df['bug_fix_hack_score'] = df['bug_fix_details'].apply(lambda x: x.get('hack_score', 0))
    df['bug_fix_hacked_score'] = df['bug_fix_details'].apply(lambda x: x.get('hacked_score', 0))
    
    with np.errstate(divide='ignore', invalid='ignore'):
        df['bug_fix_rate'] = ((df['bug_fix_hacked_count'] - df['bug_fix_unfixed_count']) / df['bug_fix_hacked_count']) * 100
        df['hack_success_rate'] = (df['hack_success'] / df['hack_total_attempts']) * 100

    df['bug_fix_rate'] = df['bug_fix_rate'].fillna(np.nan)
    df['hack_success_rate'] = df['hack_success_rate'].fillna(np.nan)

    df['hack_fix_score_ratio'] = (df['bug_fix_hack_score'] + 0.1) / (df['bug_fix_hacked_score'] + 0.1)

    return df


# --- 5. å¯è§†åŒ–æ¨¡å— ---
def create_visualizations(df, user_name, config):
    """ä¸»å‡½æ•°ï¼Œè°ƒç”¨æ‰€æœ‰å¯è§†åŒ–ç”Ÿæˆå‡½æ•°"""
    print("\næ­£åœ¨ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ï¼Œè¯·ç¨å€™...")
    create_performance_dashboard(df, user_name)
    create_unit_radar_chart(df, user_name, config)
    print("æ‰€æœ‰åˆ†ææŠ¥å‘Šä¸å›¾è¡¨å·²ç”Ÿæˆå®Œæ¯•ï¼")

def create_performance_dashboard(df, user_name):
    """ç”Ÿæˆ2x2çš„ç»¼åˆè¡¨ç°ä»ªè¡¨ç›˜"""
    fig, axes = plt.subplots(2, 2, figsize=(20, 14))
    fig.suptitle(f'{user_name} - OOè¯¾ç¨‹ç»¼åˆè¡¨ç°ä»ªè¡¨ç›˜ (V8.6)', fontsize=24, weight='bold')

    ax1 = axes[0, 0]
    df_strong = df.dropna(subset=['strong_test_score'])
    if not df_strong.empty:
        ax1.plot(df_strong['name'], df_strong['strong_test_score'], marker='o', linestyle='-', color='b', label='å¼ºæµ‹åˆ†æ•°')
        ax1.axhline(y=100, color='r', linestyle='--', label='æ»¡åˆ†çº¿ (100)', alpha=0.7)
        ax1.set_title('å­¦æœŸå¼ºæµ‹æˆç»©å˜åŒ–è¶‹åŠ¿', fontsize=16)
        ax1.set_xlabel('ä½œä¸š', fontsize=12)
        ax1.set_ylabel('åˆ†æ•°', fontsize=12)
        ax1.tick_params(axis='x', rotation=45, labelsize=9)
        ax1.grid(True, which='both', linestyle='--', linewidth=0.5)
        ax1.legend()
        ax1.set_ylim(bottom=min(80, df_strong['strong_test_score'].min() - 5 if not df_strong.empty else 80), top=105)

    ax2 = axes[0, 1]
    analysis_df = df.dropna(subset=['ddl_index', 'strong_test_deduction_count', 'hacked_success'])
    if not analysis_df.empty:
        color1 = 'tab:red'
        ax2.set_xlabel('DDL æŒ‡æ•° (è¶Šæ¥è¿‘1ï¼Œè¶Šæ™šæäº¤)', fontsize=12)
        ax2.set_ylabel('å¼ºæµ‹æ‰£åˆ†ç‚¹æ•°é‡', color=color1, fontsize=12)
        ax2.scatter(analysis_df['ddl_index'], analysis_df['strong_test_deduction_count'],
                    alpha=0.6, color=color1, label='å¼ºæµ‹æ‰£åˆ†ç‚¹')
        ax2.tick_params(axis='y', labelcolor=color1)
        
        ax2_twin = ax2.twinx()
        color2 = 'tab:blue'
        ax2_twin.set_ylabel('è¢«æˆåŠŸHackæ¬¡æ•°', color=color2, fontsize=12)
        ax2_twin.scatter(analysis_df['ddl_index'], analysis_df['hacked_success'],
                         marker='x', alpha=0.6, color=color2, label='è¢«æˆåŠŸHackæ¬¡æ•°')
        ax2_twin.tick_params(axis='y', labelcolor=color2)
        ax2.set_title('æäº¤æ—¶é—´ä¸ä»£ç è´¨é‡å…³è”', fontsize=16)
    
    ax3 = axes[1, 0]
    mutual_df = df[df.get('has_mutual_test', pd.Series(False))].dropna(subset=['offense_defense_ratio'])
    if not mutual_df.empty:
        ax3.plot(mutual_df['name'], mutual_df['offense_defense_ratio'], marker='^', linestyle=':', color='purple', label='æ”»é˜²æŒ‡æ•°')
        ax3.axhline(y=1, color='grey', linestyle='--', label='æ”»é˜²å¹³è¡¡çº¿ (æŒ‡æ•°=1)')
        ax3.set_yscale('log')
        ax3.set_title('äº’æµ‹æ”»é˜²ç­–ç•¥æ¼”åŒ– (å¯¹æ•°åæ ‡)', fontsize=16)
        ax3.set_xlabel('ä½œä¸š', fontsize=12)
        ax3.set_ylabel('æ”»é˜²æŒ‡æ•° (Hack+1)/(Hacked+1)', fontsize=12)
        ax3.tick_params(axis='x', rotation=45, labelsize=9)
        ax3.grid(True, which='both', linestyle='--', linewidth=0.5)
        ax3.legend()

    ax4 = axes[1, 1]
    bugfix_df = df.dropna(subset=['bug_fix_rate'])
    if not bugfix_df.empty:
        bars = ax4.bar(bugfix_df['name'], bugfix_df['bug_fix_rate'], color='teal', alpha=0.8)
        ax4.axhline(y=100, color='green', linestyle='--', label='100%ä¿®å¤', alpha=0.7)
        ax4.set_title('Bugä¿®å¤ç‡', fontsize=16)
        ax4.set_xlabel('ä½œä¸š', fontsize=12)
        ax4.set_ylabel('ä¿®å¤ç‡ (%)', fontsize=12)
        ax4.set_ylim(0, 110)
        ax4.tick_params(axis='x', rotation=45, labelsize=9)
        ax4.grid(axis='y', linestyle='--', linewidth=0.5)
        ax4.legend()
        for bar in bars:
            yval = bar.get_height()
            if yval > 0:
                ax4.text(bar.get_x() + bar.get_width()/2.0, yval, f'{yval:.0f}%', va='bottom', ha='center')
    else:
        ax4.text(0.5, 0.5, 'æœªå‘ç°å¯ä¾›åˆ†æçš„Bugä¿®å¤æ•°æ®', ha='center', va='center', fontsize=14, color='gray')

    plt.tight_layout(rect=[0, 0, 1, 0.96])
    plt.show()

def create_unit_radar_chart(df, user_name, config):
    unit_stats = {}
    for unit_name in config["UNIT_MAP"].keys():
        unit_df = df[df['unit'] == unit_name]
        if not unit_df.empty:
            unit_stats[unit_name] = {
                'å¼ºæµ‹è¡¨ç°': unit_df['strong_test_score'].mean(skipna=True),
                'è¿›æ”»èƒ½åŠ›': unit_df['hack_success'].sum(skipna=True),
                'é˜²å®ˆèƒ½åŠ›': unit_df['hacked_success'].sum(skipna=True)
            }
    valid_units = {k: v for k, v in unit_stats.items() if pd.notna(v.get('å¼ºæµ‹è¡¨ç°'))}
    if len(valid_units) >= 3:
        labels = list(next(iter(valid_units.values())).keys())
        stats_list = [list(d.values()) for d in valid_units.values()]
        stats_array = np.array(stats_list)
        max_hacked = np.nanmax(stats_array[:, 2])
        if max_hacked > 0: stats_array[:, 2] = max_hacked - stats_array[:, 2] 
        else: stats_array[:, 2] = 1 
        
        with np.errstate(divide='ignore', invalid='ignore'):
            max_vals = np.nanmax(stats_array, axis=0)
            max_vals[max_vals == 0] = 1 
            normalized_stats = stats_array / max_vals
        
        angles = np.linspace(0, 2 * np.pi, len(labels), endpoint=False).tolist()
        angles += angles[:1]
        
        fig, ax = plt.subplots(figsize=(10, 10), subplot_kw=dict(polar=True))
        for i, (unit_name, data) in enumerate(valid_units.items()):
            values = normalized_stats[i].tolist()
            values += values[:1]
            ax.plot(angles, values, 'o-', linewidth=2, label=re.sub(r'ï¼š.*', '', unit_name))
            ax.fill(angles, values, alpha=0.25)
        
        ax.set_thetagrids(np.degrees(angles[:-1]), labels)
        ax.set_title(f'{user_name} - å„å•å…ƒèƒ½åŠ›é›·è¾¾å›¾', size=20, color='blue', y=1.1)
        ax.legend(loc='upper right', bbox_to_anchor=(1.3, 1.1))
        plt.show()

# --- 6. åŠ¨æ€æŠ¥å‘Šç”Ÿæˆå™¨ V8.6 ---
def analyze_submission_style(hw_row):
    start, end, last_submit = hw_row.get('public_test_start_time'), hw_row.get('public_test_end_time'), hw_row.get('public_test_last_submit')
    if pd.isna(start) or pd.isna(end) or pd.isna(last_submit): return random.choice(ReportCorpus.STYLE_UNKNOWN)
    total_duration = end - start
    if total_duration.total_seconds() <= 0: return random.choice(ReportCorpus.STYLE_UNKNOWN)
    ratio = (last_submit - start).total_seconds() / total_duration.total_seconds()
    if ratio <= 0.2: return random.choice(ReportCorpus.STYLE_EARLY_BIRD)
    elif ratio >= 0.8: return random.choice(ReportCorpus.STYLE_DDL_FIGHTER)
    else: return random.choice(ReportCorpus.STYLE_WELL_PACED)

def generate_highlights(df):
    """[V8.6-Refined] ç”Ÿæˆæœ€å¤š5ä¸ªå¤šæ ·åŒ–çš„ä¸ªäººäº®ç‚¹æ ‡ç­¾ï¼Œä¼˜å…ˆè¦†ç›–ä¸åŒç±»åˆ«ï¼Œå¹¶ä½¿ç”¨éšæœºé€‰æ‹©ä»£æ›¿è¯„åˆ†ã€‚"""
    if df.empty:
        return []
    
    all_possible_highlights = []

    def add_highlight(key, text):
        all_possible_highlights.append((key, text))

    strong_scores = df['strong_test_score'].dropna()
    mutual_df = df[df.get('has_mutual_test', pd.Series(True))].dropna(subset=['hack_success', 'hacked_success'])
    submit_times_df = df.dropna(subset=['public_test_used_times'])
    
    # === æ™®é€‚å‹æ ‡ç­¾ (æˆé•¿æ€åº¦) ===
    if not submit_times_df.empty:
        total_submissions = int(submit_times_df['public_test_used_times'].sum())
        if total_submissions > 30: 
            add_highlight("DILIGENT_EXPLORER", ReportCorpus.HIGHLIGHTS_TAGS["DILIGENT_EXPLORER"].format(total_submissions=total_submissions))
    if len(strong_scores) > 1:
        for i in range(len(df) - 1):
            hw1, hw2 = df.iloc[i], df.iloc[i+1]
            s1, s2 = hw1.get('strong_test_score'), hw2.get('strong_test_score')
            if pd.notna(s1) and pd.notna(s2) and s1 < 80 and s2 - s1 > 15:
                add_highlight("THE_PERSEVERER", ReportCorpus.HIGHLIGHTS_TAGS["THE_PERSEVERER"].format(low_score_hw=hw1['name'], rebound_hw=hw2['name']))
                break
    if not mutual_df.empty:
        active_row = mutual_df.loc[mutual_df['hack_total_attempts'].idxmax(skipna=True)] if 'hack_total_attempts' in mutual_df.columns and not mutual_df['hack_total_attempts'].empty else None
        if active_row is not None and active_row['hack_total_attempts'] > 10:
             add_highlight("ACTIVE_COLLABORATOR", ReportCorpus.HIGHLIGHTS_TAGS["ACTIVE_COLLABORATOR"].format(hw_name=active_row['name'], hack_attempts=int(active_row['hack_total_attempts'])))
    bugfix_df = df.dropna(subset=['bug_fix_hacked_count'])
    if not bugfix_df.empty and bugfix_df['bug_fix_hacked_count'].sum() > 0 and bugfix_df['bug_fix_unfixed_count'].sum() == 0:
        add_highlight("BUG_FIXER_PRO", ReportCorpus.HIGHLIGHTS_TAGS["BUG_FIXER_PRO"])
    unit2_df = df[df['unit'].str.contains("ç¬¬äºŒå•å…ƒ", na=False)]
    if not unit2_df.empty:
        has_perf_issues = any("TIME" in str(s) for s in unit2_df['strong_test_issues'].dropna())
        if has_perf_issues and unit2_df['strong_test_score'].mean() > 95:
             add_highlight("PERFORMANCE_CHALLENGER", ReportCorpus.HIGHLIGHTS_TAGS["PERFORMANCE_CHALLENGER"])

    # === æ•ˆç‡ä¸æ–¹æ³•å‹ (é«˜æ•ˆç­–ç•¥) ===
    ddl_comeback_df = df[(df['ddl_index'] > 0.9) & (df['strong_test_score'] > 85)]
    if len(ddl_comeback_df) >= 2:
        add_highlight("DEADLINE_COMEBACK", ReportCorpus.HIGHLIGHTS_TAGS["DEADLINE_COMEBACK"].format(hw_name=ddl_comeback_df.iloc[0]['name']))
    if not submit_times_df.empty:
        min_submit_row = submit_times_df.loc[submit_times_df['public_test_used_times'].idxmin()]
        if min_submit_row['public_test_used_times'] <= 2:
            add_highlight("EFFICIENCY_ACE", ReportCorpus.HIGHLIGHTS_TAGS["EFFICIENCY_ACE"].format(hw_name=min_submit_row['name']))
    early_submitters = df[df['ddl_index'] < 0.1]
    if len(early_submitters) >= 3:
        add_highlight("FAST_STARTER", ReportCorpus.HIGHLIGHTS_TAGS["FAST_STARTER"].format(hw_name=early_submitters.iloc[0]['name']))

    # === é«˜åˆ†ä¸å“è¶Šå‹ (å“è¶Šè¡¨ç°) ===
    if not strong_scores.empty and not mutual_df.empty and strong_scores.min() > 95 and mutual_df['hacked_success'].sum() <= 1:
        add_highlight("ROCK_SOLID", ReportCorpus.HIGHLIGHTS_TAGS["ROCK_SOLID"].format(min_score=strong_scores.min()))
    if not mutual_df.empty and (mutual_df['hacked_success'] == 0).mean() >= 0.75:
        add_highlight("DEFENSE_MASTER", ReportCorpus.HIGHLIGHTS_TAGS["DEFENSE_MASTER"])
    if not strong_scores.empty and strong_scores.mean() > 98.5:
        add_highlight("TOP_SCORER", ReportCorpus.HIGHLIGHTS_TAGS["TOP_SCORER"].format(avg_score=strong_scores.mean()))
    
    # === åšå¼ˆ/æƒ…æ™¯åŒ–æ ‡ç­¾ (åšå¼ˆé«˜æ‰‹ & å“è¶Šè¡¨ç°) ===
    if not mutual_df.empty and not mutual_df['hack_success'].empty:
        max_hack_row = mutual_df.loc[mutual_df['hack_success'].idxmax()]
        if max_hack_row['hack_success'] >= 10:
            add_highlight("HACK_ARTIST", ReportCorpus.HIGHLIGHTS_TAGS["HACK_ARTIST"].format(hw_name=max_hack_row['name'], count=int(max_hack_row['hack_success'])))
    for _, hw in df.iterrows():
        if pd.notna(hw.get('hack_success_rate')) and hw.get('hack_total_attempts', 0) > 3 and hw['hack_success_rate'] > 20:
            add_highlight("PRECISION_STRIKER", ReportCorpus.HIGHLIGHTS_TAGS["PRECISION_STRIKER"].format(hw_name=hw['name'], rate=hw['hack_success_rate']))
        if hw.get('hack_success', 0) > 4 and hw.get('successful_hack_targets', 100) <= 2:
            add_highlight("TACTICAL_MASTER", ReportCorpus.HIGHLIGHTS_TAGS["TACTICAL_MASTER"].format(hw_name=hw['name'], target_count=int(hw['successful_hack_targets'])))
        if hw.get('room_total_hacked', 0) > 20 and hw.get('hacked_success', 100) <= 1:
            add_highlight("STORM_SURVIVOR", ReportCorpus.HIGHLIGHTS_TAGS["STORM_SURVIVOR"].format(hw_name=hw['name'], room_total_hacked=int(hw['room_total_hacked']), self_hacked=int(hw['hacked_success'])))

    # === å•å…ƒä¸“ç²¾ä¸æˆé•¿å‹ (å“è¶Šè¡¨ç° & æˆé•¿æ€åº¦) ===
    unit3_df = df[df['unit'].str.contains("ç¬¬ä¸‰å•å…ƒ", na=False)]
    if not unit3_df.empty and unit3_df['strong_test_score'].mean() > 99 and unit3_df['hacked_success'].sum() == 0:
        add_highlight("JML_MASTER", ReportCorpus.HIGHLIGHTS_TAGS["JML_MASTER"])
    unit4_df = df[df['unit'].str.contains("ç¬¬å››å•å…ƒ", na=False)]
    if not unit4_df.empty and unit4_df['strong_test_score'].mean() == 100:
        is_perfect = all(all(r['message'] == 'ACCEPTED' for r in row.get('uml_detailed_results', [])) for _, row in unit4_df.iterrows() if row.get('uml_detailed_results'))
        if is_perfect:
            add_highlight("UML_EXPERT", ReportCorpus.HIGHLIGHTS_TAGS["UML_EXPERT"])
    for unit_name in df['unit'].unique():
        unit_df = df[df['unit'] == unit_name].sort_values('hw_num')
        if len(unit_df) > 1:
            scores = unit_df['strong_test_score'].dropna()
            if len(scores) > 1 and scores.iloc[-1] - scores.iloc[0] > 10 and scores.iloc[-1] > 95:
                add_highlight("REFACTOR_VIRTUOSO", ReportCorpus.HIGHLIGHTS_TAGS["REFACTOR_VIRTUOSO"].format(unit_name=re.sub(r'ï¼š.*', '', unit_name), hw_name_before=unit_df.iloc[0]['name'], hw_name_after=unit_df.iloc[-1]['name']))
                break
    unit_scores = df.groupby('unit')['strong_test_score'].mean()
    u1_key, u4_key = "ç¬¬ä¸€å•å…ƒï¼šè¡¨è¾¾å¼æ±‚å¯¼", "ç¬¬å››å•å…ƒï¼šUMLè§£æ"
    if u1_key in unit_scores and u4_key in unit_scores:
        u1_score, u4_score = unit_scores[u1_key], unit_scores[u4_key]
        if pd.notna(u1_score) and pd.notna(u4_score) and u4_score > u1_score + 2:
            add_highlight("COMEBACK_KING", ReportCorpus.HIGHLIGHTS_TAGS["COMEBACK_KING"].format(u1_score=u1_score, u4_score=u4_score))

    if not all_possible_highlights:
        return []

    highlights_by_category = {}
    for key, text in all_possible_highlights:
        category = ReportCorpus.HIGHLIGHTS_CATEGORIES.get(key, "å…¶ä»–")
        if category not in highlights_by_category:
            highlights_by_category[category] = []
        highlights_by_category[category].append(text)

    final_highlights = []
    available_categories = list(highlights_by_category.keys())
    random.shuffle(available_categories)

    if len(available_categories) >= 5:
        chosen_categories = random.sample(available_categories, 5)
        for category in chosen_categories:
            final_highlights.append(random.choice(highlights_by_category[category]))
    else:
        leftover_highlights = []
        for category in available_categories:
            category_highlights = highlights_by_category[category]
            random.shuffle(category_highlights)
            final_highlights.append(category_highlights.pop(0))
            leftover_highlights.extend(category_highlights)
        
        needed = 5 - len(final_highlights)
        if needed > 0 and leftover_highlights:
            random.shuffle(leftover_highlights)
            final_highlights.extend(leftover_highlights[:needed])

    random.shuffle(final_highlights)
    return final_highlights[:5]

def identify_student_persona(df):
    if df.empty: return "BALANCED"
    mutual_df = df[df.get('has_mutual_test', pd.Series(False))]
    if df['ddl_index'].dropna().mean() > 0.8: return "SPRINTER"
    if not mutual_df.empty and mutual_df['hack_success'].sum() > 25: return "HUNTER"
    if (not mutual_df.empty and mutual_df['hacked_success'].sum() <= 3) and df['strong_test_score'].var() < 10: return "FORTRESS"
    if df['public_test_used_times'].dropna().mean() > 6: return "GRINDER"
    return "BALANCED"

def format_uml_analysis(hw_row):
    uml_results = hw_row.get('uml_detailed_results', [])
    if not uml_results: return ""
    failed_checks = [r['name'] for r in uml_results if r['message'] != 'ACCEPTED']
    if not failed_checks: return random.choice(ReportCorpus.UML_ANALYSIS["PERFECT"])
    else: return random.choice(ReportCorpus.UML_ANALYSIS["IMPERFECT"]).format(issues=', '.join(failed_checks))

def _analyze_overall_performance(df):
    """[V8.6] è¾…åŠ©å‡½æ•°ï¼Œç”Ÿæˆå®è§‚è¡¨ç°çš„æ–‡å­—åˆ†æï¼ŒåŠ å…¥ç›¸å¯¹è¡¨ç°å’Œé˜²å¾¡éŸ§æ€§åˆ†æ"""
    analysis_texts = []
    
    strong_scores = df['strong_test_score'].dropna()
    if not strong_scores.empty:
        avg_score, var_score = strong_scores.mean(), strong_scores.var()
        analysis_texts.append(f"å¼ºæµ‹è¡¨ç°: å¹³å‡åˆ† {avg_score:.2f} | ç¨³å®šæ€§ (æ–¹å·®) {var_score:.2f}")
        if avg_score > 98: analysis_texts.append(random.choice(ReportCorpus.STRONG_TEST_HIGH_SCORE))
        else:
            imperfect_hws = df[df['strong_test_score'] < 100]['name'].tolist()
            if imperfect_hws: analysis_texts.append(random.choice(ReportCorpus.STRONG_TEST_IMPERFECTION).format(hw_names=', '.join(imperfect_hws[:2])))
        if var_score < 15: analysis_texts.append(random.choice(ReportCorpus.CONSISTENCY_STABLE).format(variance=var_score))
        else:
            best_hw = df.loc[df['strong_test_score'].idxmax()]['name'] if pd.notna(df['strong_test_score'].max()) else 'æŸæ¬¡ä½œä¸š'
            worst_hw = df.loc[df['strong_test_score'].idxmin()]['name'] if pd.notna(df['strong_test_score'].min()) else 'å¦ä¸€æ¬¡ä½œä¸š'
            analysis_texts.append(random.choice(ReportCorpus.CONSISTENCY_VOLATILE).format(variance=var_score, best_hw=best_hw, worst_hw=worst_hw))

    mutual_df = df[df.get('has_mutual_test', pd.Series(False))].dropna(subset=['hack_success', 'hacked_success', 'hacked_total_attempts'])
    if not mutual_df.empty:
        total_hacks = mutual_df['hack_success'].sum()
        total_hacked = mutual_df['hacked_success'].sum()
        total_hacked_attempts = mutual_df['hacked_total_attempts'].sum()
        
        analysis_texts.append(f"\näº’æµ‹æˆ˜ç»©: æˆåŠŸHack {int(total_hacks)} æ¬¡ | è¢«æˆåŠŸHack {int(total_hacked)} æ¬¡ (æ€»è®¡è¢«æ”»å‡» {int(total_hacked_attempts)} æ¬¡)")

        profile_found = False
        
        # [V8.6 ä¿®å¤] Offensive profile check with accurate data
        if total_hacks > total_hacked * 2 and total_hacks >= 10:
            hw_with_most_hacks = mutual_df.loc[mutual_df['hack_success'].idxmax()]
            total_unique_targets = mutual_df['successful_hack_targets'].sum()
            total_hack_attempts = mutual_df['hack_total_attempts'].sum()
            overall_hack_rate = (total_hacks / total_hack_attempts) * 100 if total_hack_attempts > 0 else 0

            offensive_format_vars = {
                'hw_name_most_hacks': hw_with_most_hacks['name'],
                'hacks_in_best_hw': int(hw_with_most_hacks['hack_success']),
                'total_hacks': int(total_hacks),
                'total_unique_targets': int(total_unique_targets),
                'overall_hack_rate': overall_hack_rate
            }
            analysis_texts.append(random.choice(ReportCorpus.MUTUAL_TEST_OFFENSIVE).format(**offensive_format_vars))
            profile_found = True
        
        # Defensive profile check (low successful hacks)
        if total_hacked <= 3:
            analysis_texts.append(random.choice(ReportCorpus.MUTUAL_TEST_DEFENSIVE).format(count=int(total_hacked_attempts), hw_names="å„æ¬¡", hacked="å¤š"))
            profile_found = True
        
        # Battle-Hardened profile check (high attempts, low success rate)
        if total_hacked_attempts > 20: 
            hacked_rate = (total_hacked / total_hacked_attempts) * 100 if total_hacked_attempts > 0 else 0
            if hacked_rate < 15:
                analysis_texts.append(random.choice(ReportCorpus.MUTUAL_TEST_BATTLE_HARDENED).format(
                    total_hacked_attempts=int(total_hacked_attempts),
                    total_hacked=int(total_hacked),
                    rate=hacked_rate
                ))
                profile_found = True
        
        if not profile_found:
            # [V8.6 ä¿®å¤] Balanced profile check with accurate data
            balanced_format_vars = {
                'total_hacks': int(total_hacks),
                'total_hacked': int(total_hacked)
            }
            analysis_texts.append(random.choice(ReportCorpus.MUTUAL_TEST_BALANCED).format(**balanced_format_vars))

        # V8.5 æ–°å¢ï¼šç›¸å¯¹è¡¨ç°åˆ†æ
        room_df = df.dropna(subset=['room_level'])
        if not room_df.empty:
            a_room_rate = (room_df['room_level'] == 'A').mean() * 100
            if a_room_rate > 60:
                # This format string is general enough and doesn't need specific fixes
                analysis_texts.append(random.choice(ReportCorpus.MUTUAL_TEST_RELATIVE_PERFORMANCE).format(a_room_rate=a_room_rate, count=0, hw_names="å¤šæ¬¡", term="æœ¬"))

        total_weighted_deduction = mutual_df['weighted_defense_deduction'].sum()
        max_possible_deduction = mutual_df.shape[0] * 10 
        defense_score = 100 - (total_weighted_deduction / (max_possible_deduction * 10) * 100) if max_possible_deduction > 0 else 100
        analysis_texts.append(random.choice(ReportCorpus.DEFENSE_SCORE_ANALYSIS).format(score=max(0, defense_score)))

    unit2_df = df[df['unit'].str.contains("ç¬¬äºŒå•å…ƒ", na=False)]
    if not unit2_df.empty:
        perf_issues = {}
        for _, row in unit2_df.iterrows():
            for issue, count in row.get('strong_test_issues', {}).items():
                if "TIME_LIMIT_EXCEED" in issue:
                    perf_issues.setdefault(issue, []).append(row['name'])
        if perf_issues:
            issue_types = ", ".join(perf_issues.keys())
            hw_names = ", ".join(list(set(sum(perf_issues.values(), []))))
            analysis_texts.append("\n" + random.choice(ReportCorpus.PERFORMANCE_ISSUE).format(hw_names=hw_names, issue_types=issue_types))
            
    return analysis_texts

def _analyze_hack_strategy(df):
    """[V8.5 æ–°å¢] åˆ†æäº’æµ‹åšå¼ˆç­–ç•¥"""
    texts = []
    mutual_df = df.dropna(subset=['mutual_test_start_time', 'mutual_test_end_time', 'mutual_test_events'])
    mutual_df = mutual_df[mutual_df['mutual_test_events'].apply(len) > 0]
    if mutual_df.empty:
        return []

    early_hacks, late_hacks, total_hacks = 0, 0, 0
    total_attempts, total_unique_targets = 0, 0

    for _, hw in mutual_df.iterrows():
        duration = (hw['mutual_test_end_time'] - hw['mutual_test_start_time']).total_seconds()
        if duration <= 0: continue
        events = hw['mutual_test_events']
        total_hacks += len(events)
        total_attempts += len(events)
        total_unique_targets += len(set(e['target'] for e in events))

        for event in events:
            hack_time = pd.to_datetime(event['time'])
            ratio = (hack_time - hw['mutual_test_start_time']).total_seconds() / duration
            if ratio < 0.1: early_hacks += 1
            if ratio > 0.9: late_hacks += 1

    if total_hacks == 0: return []
    
    if early_hacks / total_hacks > 0.5:
        texts.append(ReportCorpus.HACK_TIMING_ANALYSIS["EARLY_BIRD"])
    elif late_hacks / total_hacks > 0.5:
        texts.append(ReportCorpus.HACK_TIMING_ANALYSIS["DEADLINE_SNIPER"])
    else:
        texts.append(ReportCorpus.HACK_TIMING_ANALYSIS["CONSISTENT_PRESSURE"])

    concentration_ratio = total_attempts / total_unique_targets if total_unique_targets > 0 else 0
    if concentration_ratio > 2.5:
        texts.append(ReportCorpus.HACK_TARGETING_ANALYSIS["FOCUSED_FIRE"])
    else:
        texts.append(ReportCorpus.HACK_TARGETING_ANALYSIS["WIDE_NET"])
    
    return texts

def generate_dynamic_report(df, user_name, config):
    print("\n" + "="*80)
    print(f" {user_name} - OOè¯¾ç¨‹åŠ¨æ€å­¦ä¹ è½¨è¿¹æŠ¥å‘Š V8.6 ".center(80, "="))
    print("="*80)
    
    if df.empty:
        print("\næœªæ‰¾åˆ°è¯¥å­¦ç”Ÿçš„æœ‰æ•ˆä½œä¸šæ•°æ®ï¼Œè¯·æ£€æŸ¥é…ç½®æ–‡ä»¶ã€‚")
        return

    persona = identify_student_persona(df)
    print("\n" + ReportCorpus.PERSONA_ANALYSIS[persona].format(user_name=user_name))

    highlights = generate_highlights(df)
    if highlights:
        print("\n" + "--- 1. ä¸ªäººäº®ç‚¹æ ‡ç­¾ ---".center(70))
        print(random.choice(ReportCorpus.HIGHLIGHTS_INTRO))
        for tag in highlights:
            print(tag)

    print("\n" + "--- 2. å®è§‚å­¦æœŸè¡¨ç°ä¸æ·±åº¦æ´å¯Ÿ ---".center(70))
    for text in _analyze_overall_performance(df):
        print(text)
    
    print("\n" + "--- 3. å¼€å‘è€…è´£ä»»æ„Ÿä¸è°ƒè¯•èƒ½åŠ› (Bugä¿®å¤) ---".center(70))
    bugfix_df = df.dropna(subset=['bug_fix_hacked_count'])
    total_bugs = bugfix_df['bug_fix_hacked_count'].sum()
    if total_bugs > 0:
        fixed_bugs = total_bugs - bugfix_df['bug_fix_unfixed_count'].sum()
        fix_rate = (fixed_bugs / total_bugs) * 100
        print(ReportCorpus.BUG_FIX_ANALYSIS["HIGH_FIX_RATE" if fix_rate > 80 else "LOW_FIX_RATE"].format(total_bugs=int(total_bugs), fixed_bugs=int(fixed_bugs), rate=fix_rate))
            
        total_hack_score, total_hacked_score = bugfix_df['bug_fix_hack_score'].sum(), bugfix_df['bug_fix_hacked_score'].sum()
        if total_hack_score + total_hacked_score > 0:
            ratio = (total_hack_score + 0.1) / (total_hacked_score + 0.1)
            if ratio > 1.5: print(ReportCorpus.BUG_FIX_ANALYSIS["HACK_FOCUSED"].format(hack_score=total_hack_score, hacked_score=total_hacked_score, ratio=ratio))
            elif ratio < 0.7: print(ReportCorpus.BUG_FIX_ANALYSIS["FIX_FOCUSED"].format(hack_score=total_hack_score, hacked_score=total_hacked_score, ratio=ratio))
        print(random.choice(ReportCorpus.BUG_FIX_INSIGHT))
    else:
        print(ReportCorpus.BUG_FIX_ANALYSIS["NO_BUGS_TO_FIX"])

    print("\n" + "--- 4. å•å…ƒæ·±åº¦ä¸æˆé•¿è½¨è¿¹ ---".center(70))
    unit_paradigms = {"ç¬¬ä¸€å•å…ƒ": "é€’å½’ä¸‹é™", "ç¬¬äºŒå•å…ƒ": "å¤šçº¿ç¨‹", "ç¬¬ä¸‰å•å…ƒ": "JMLè§„æ ¼", "ç¬¬å››å•å…ƒ": "UMLè§£æ"}
    for unit_name_full, hw_nums in config["UNIT_MAP"].items():
        unit_df = df[df['unit'] == unit_name_full]
        unit_name_short = re.sub(r'ï¼š.*', '', unit_name_full)
        if not unit_df.empty and pd.notna(unit_df['strong_test_score'].mean()):
            print(random.choice(ReportCorpus.UNIT_ANALYSIS).format(unit_name=unit_name_short, avg_score=unit_df['strong_test_score'].mean(), unit_paradigm=unit_paradigms.get(unit_name_short, "æ ¸å¿ƒæŠ€æœ¯"), hacks=int(unit_df['hack_success'].sum()), hacked=int(unit_df['hacked_success'].sum())))

    strong_scores = df['strong_test_score'].dropna()
    if len(strong_scores) > 8:
        early_avg, later_avg = strong_scores.iloc[:len(strong_scores)//2].mean(), strong_scores.iloc[len(strong_scores)//2:].mean()
        if later_avg > early_avg + 1:
            print(random.choice(ReportCorpus.GROWTH_ANALYSIS).format(early_avg=early_avg, later_avg=later_avg))
            
    print("\n" + "--- 5. æäº¤è¡Œä¸ºä¸é£é™©åˆ†æ ---".center(70))
    print(random.choice(ReportCorpus.SUBMISSION_ANALYSIS_INTRO))
    submit_times_df = df.dropna(subset=['public_test_used_times'])
    if not submit_times_df.empty:
        total_submissions = submit_times_df['public_test_used_times'].sum()
        print(f"æœ¬å­¦æœŸä½ å…±æäº¤ {int(total_submissions)} æ¬¡ä»£ç ã€‚")
        most_submitted, least_submitted = submit_times_df.loc[submit_times_df['public_test_used_times'].idxmax()], submit_times_df.loc[submit_times_df['public_test_used_times'].idxmin()]
        print(random.choice(ReportCorpus.SUBMISSION_MOST).format(hw_name=most_submitted['name'], count=int(most_submitted['public_test_used_times'])))
        print(random.choice(ReportCorpus.SUBMISSION_LEAST).format(hw_name=least_submitted['name'], count=int(least_submitted['public_test_used_times'])))
    
    ddl_risk_df = df[(df['ddl_index'] > 0.9) & ((df['strong_test_deduction_count'] > 0) | (df['hacked_success'] > 0))]
    if len(ddl_risk_df) > len(df) * 0.1:
        print(random.choice(ReportCorpus.DDL_ANALYSIS))

    hack_strategy_texts = _analyze_hack_strategy(df)
    if hack_strategy_texts:
        print("\n" + "--- 6. äº’æµ‹åšå¼ˆç­–ç•¥åˆ†æ ---".center(70))
        print(random.choice(ReportCorpus.HACK_STRATEGY_INTRO))
        for text in hack_strategy_texts:
            print(text)

    print("\n" + "--- 7. é€æ¬¡ä½œä¸šæ·±åº¦è§£æ ---".center(70))
    print(random.choice(ReportCorpus.HW_ANALYSIS_INTRO))
    for _, hw in df.iterrows():
        print(f"\n--- {hw['name']} ---")
        if pd.notna(hw.get('strong_test_score')):
            score_str = f"  - å¼ºæµ‹: {hw.get('strong_test_score'):.2f}"
            if hw.get('strong_test_deduction_count', 0) > 0:
                issue_str = ", ".join([f"{k}({v}æ¬¡)" for k,v in hw.get('strong_test_issues', {}).items()])
                score_str += f" | æ‰£åˆ†: {issue_str}"
            print(score_str)
        if hw.get('has_mutual_test') and pd.notna(hw.get('hack_success')):
            hack_info = f"Hack {int(hw.get('hack_success', 0))} | è¢«æˆåŠŸHack {int(hw.get('hacked_success', 0))} (è¢«æ”»å‡» {int(hw.get('hacked_total_attempts', 0))} æ¬¡)"
            if pd.notna(hw.get('room_avg_hacked')):
                 hack_info += f" (æˆ¿å‡è¢«Hack: {hw.get('room_avg_hacked', 0):.2f})"
            print(f"  - äº’æµ‹: åœ¨ {hw.get('room_level', '?')} æˆ¿åŒ–èº«ã€Œ{hw.get('alias_name', '?')}ã€ï¼Œ{hack_info}")
        
        if hw['unit'].startswith("ç¬¬å››å•å…ƒ"):
            print(format_uml_analysis(hw))
            
        print(f"  - æäº¤: {analyze_submission_style(hw)}")

    print("\n" + "="*80)
    print(" å­¦æœŸæ—…ç¨‹æ€»ç»“ ".center(80, "="))
    print("="*80)
    print(random.choice(ReportCorpus.OVERALL_CONCLUSION))

# --- 7. ä¸»æ‰§è¡Œé€»è¾‘ ---
def main(student_id):
    try:
        if not student_id or not student_id.isdigit():
            raise ValueError(f"é”™è¯¯: '{CONFIG['YAML_CONFIG_PATH']}' ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„ 'stu_id'ã€‚")

        file_path = Path(CONFIG["FILE_PATH"])
        if not file_path.exists(): raise FileNotFoundError(f"é”™è¯¯: æœªæ‰¾åˆ°æ•°æ®æ–‡ä»¶ '{file_path}'ã€‚")
        with open(file_path, 'r', encoding='utf-8') as f:
            raw_json_data = json.load(f)
        
        find_and_update_user_info(student_id, raw_json_data, CONFIG)

        raw_df = pd.DataFrame(parse_course_data(raw_json_data, CONFIG))
        df = preprocess_and_calculate_metrics(raw_df)
        
        user_display_name = CONFIG["USER_INFO"].get("real_name")

        generate_dynamic_report(df, user_display_name, CONFIG)
        create_visualizations(df, user_display_name, CONFIG)

    except (FileNotFoundError, ValueError) as e:
        print(e)
    except Exception as e:
        print(f"\nå¤„ç†æ•°æ®æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")
        import traceback
        traceback.print_exc()

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description="é€šè¿‡ Playwright è‡ªåŠ¨æ•è·åŒ—èˆªOOè¯¾ç¨‹ç½‘ç«™çš„APIæ•°æ®ã€‚")
    
    # æ·»åŠ å¿…è¦çš„å‘½ä»¤è¡Œå‚æ•°ï¼šå­¦å·å’Œå¯†ç 
    parser.add_argument("student_id", help="ç”¨äºç™»å½•çš„å­¦å· (ä¾‹å¦‚: 23371265)")    
    # è§£æå‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°
    args = parser.parse_args()
    
    # è¿è¡Œä¸»å¼‚æ­¥å‡½æ•°ï¼Œå¹¶å°†è§£æåˆ°çš„å‚æ•°ä¼ é€’è¿›å»
    main(args.student_id)